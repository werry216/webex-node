{"version":3,"sources":["index.js"],"names":["Conversation","payloadTransformer","predicates","name","test","ctx","optionsOrResponse","resolve","extract","body","direction","event","activity","response","multistatus","map","item","data","options","items","transforms","fn","array","all","transform","then","decrypt","object","objectType","content","webex","config","conversation","inboundProcessFunc","allowedInboundTags","allowedInboundStyles","c","outboundProcessFunc","allowedOutboundTags","allowedOutboundStyles","activities","participants","actor","target","threadActivity","childActivities","person","email","entryEmail","emailAddress","id","entryUUID","patterns","toLowerCase","roomProperties","isModerator","Boolean","uuid","reject","Error","internal","user","asUUID","concat","decryptionTransforms","encryptionTransforms"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport '@webex/internal-plugin-encryption';\nimport '@webex/internal-plugin-user';\n\nimport {patterns} from '@webex/common';\nimport {filter as htmlFilter, filterEscape as htmlFilterEscape} from '@webex/helper-html';\nimport {registerInternalPlugin} from '@webex/webex-core';\nimport {capitalize, get, has} from 'lodash';\n\nimport Conversation from './conversation';\nimport config from './config';\nimport {transforms as encryptionTransforms} from './encryption-transforms';\nimport {transforms as decryptionTransforms} from './decryption-transforms';\n\nregisterInternalPlugin('conversation', Conversation, {\n  payloadTransformer: {\n    predicates: [\n      {\n        name: 'transformObject',\n        test(ctx, optionsOrResponse) {\n          return Promise.resolve(has(optionsOrResponse, 'body.objectType'));\n        },\n        extract(optionsOrResponse) {\n          return Promise.resolve(optionsOrResponse.body);\n        }\n      },\n      {\n        name: 'transformObject',\n        direction: 'inbound',\n        test(ctx, event) {\n          return Promise.resolve(has(event, 'activity'));\n        },\n        extract(event) {\n          return Promise.resolve(event.activity);\n        }\n      },\n      {\n        name: 'transformObjectArray',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'body.multistatus'));\n        },\n        extract(response) {\n          return Promise.resolve(response.body.multistatus.map((item) => item && item.data && item.data.activity));\n        }\n      },\n      {\n        name: 'normalizeConversationListAndBindDecrypters',\n        direction: 'inbound',\n        test(ctx, options) {\n          if (!has(options, 'body.items[0].objectType')) {\n            return Promise.resolve(false);\n          }\n\n          if (get(options, 'options.deferDecrypt')) {\n            return Promise.resolve(true);\n          }\n\n          return Promise.resolve(false);\n        },\n        extract(options) {\n          return Promise.resolve(options.body.items);\n        }\n      },\n      {\n        name: 'transformObjectArray',\n        direction: 'inbound',\n        test(ctx, options) {\n          if (!has(options, 'body.items[0].objectType')) {\n            return Promise.resolve(false);\n          }\n\n          if (get(options, 'options.deferDecrypt')) {\n            return Promise.resolve(false);\n          }\n\n          return Promise.resolve(true);\n        },\n        extract(options) {\n          return Promise.resolve(options.body.items);\n        }\n      },\n      {\n        name: 'transformThreadArray',\n        direction: 'inbound',\n        test(ctx, options) {\n          if (!has(options, 'body.items[0].childType') || !has(options, 'body.items[0].actorId')) {\n            return Promise.resolve(false);\n          }\n\n          if (get(options, 'options.deferDecrypt')) {\n            return Promise.resolve(false);\n          }\n\n          return Promise.resolve(true);\n        },\n        extract(options) {\n          return Promise.resolve(options.body.items);\n        }\n      }\n    ],\n    transforms: [\n      {\n        name: 'normalizeConversationListAndBindDecrypters',\n        fn(ctx, array) {\n          return Promise.all(array.map((item) => ctx.transform('normalizeObject', item)\n            .then(() => {\n              item.decrypt = function decrypt() {\n                Reflect.deleteProperty(item, 'decrypt');\n\n                return ctx.transform('decryptObject', item);\n              };\n\n              return item;\n            })));\n        }\n      },\n      {\n        name: 'transformObjectArray',\n        fn(ctx, array) {\n          return Promise.all(array.map((item) => ctx.transform('transformObject', item)));\n        }\n      },\n      {\n        name: 'transformThreadArray',\n        fn(ctx, array) {\n          return Promise.all(array.map((item) => ctx.transform('transformThread', item)));\n        }\n      },\n      {\n        name: 'transformObject',\n        direction: 'outbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.objectType) {\n            return Promise.resolve();\n          }\n\n          return ctx.transform('normalizeObject', object)\n            .then(() => ctx.transform('encryptObject', object))\n            .then(() => ctx.transform('encryptKmsMessage', object));\n        }\n      },\n      {\n        name: 'transformObject',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.objectType) {\n            return Promise.resolve();\n          }\n\n          return ctx.transform('decryptObject', object)\n            .then(() => ctx.transform('normalizeObject', object));\n        }\n      },\n      {\n        name: 'normalizeObject',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.objectType) {\n            return Promise.resolve();\n          }\n\n          return Promise.all([\n            ctx.transform(`normalize${capitalize(object.objectType)}`, object),\n            ctx.transform('normalizePropContent', object)\n          ]);\n        }\n      },\n      {\n        name: 'transformThread',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          return ctx.transform('decryptThread', object)\n            .then(() => ctx.transform('normalizeThread', object));\n        }\n      },\n      {\n        name: 'normalizePropContent',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object.content) {\n            return Promise.resolve();\n          }\n          const {\n            inboundProcessFunc,\n            allowedInboundTags,\n            allowedInboundStyles\n          } = ctx.webex.config.conversation;\n\n          return htmlFilter(inboundProcessFunc, allowedInboundTags || {}, allowedInboundStyles, object.content)\n            .then((c) => {\n              object.content = c;\n            });\n        }\n      },\n      {\n        name: 'normalizePropContent',\n        direction: 'outbound',\n        fn(ctx, object) {\n          if (!object.content) {\n            return Promise.resolve();\n          }\n\n          const {\n            outboundProcessFunc,\n            allowedOutboundTags,\n            allowedOutboundStyles\n          } = ctx.webex.config.conversation;\n\n          return htmlFilterEscape(outboundProcessFunc, allowedOutboundTags || {}, allowedOutboundStyles, object.content)\n            .then((c) => {\n              object.content = c;\n            });\n        }\n      },\n      {\n        name: 'normalizeConversation',\n        fn(ctx, conversation) {\n          conversation.activities = conversation.activities || {};\n          conversation.activities.items = conversation.activities.items || [];\n          conversation.participants = conversation.participants || {};\n          conversation.participants.items = conversation.participants.items || [];\n\n          return Promise.all([\n            Promise.all(conversation.activities.items.map((item) => ctx.transform('normalizeObject', item))),\n            Promise.all(conversation.participants.items.map((item) => ctx.transform('normalizeObject', item)))\n          ]);\n        }\n      },\n      {\n        name: 'normalizeActivity',\n        fn(ctx, activity) {\n          return Promise.all([\n            ctx.transform('normalizeObject', activity.actor),\n            ctx.transform('normalizeObject', activity.object),\n            ctx.transform('normalizeObject', activity.target)\n          ]);\n        }\n      },\n      {\n        name: 'normalizeThread',\n        fn(ctx, threadActivity) {\n          // childActivities are of type Activity\n          return Promise.all(threadActivity.childActivities.map((item) => ctx.transform('normalizeObject', item)));\n        }\n      },\n      {\n        name: 'normalizePerson',\n        // eslint-disable-next-line complexity\n        fn(ctx, person) {\n          const email = person.entryEmail || person.emailAddress || person.id;\n          const id = person.entryUUID || person.id;\n\n          if (patterns.email.test(email)) {\n            person.entryEmail = person.emailAddress = email.toLowerCase();\n          }\n          else {\n            Reflect.deleteProperty(person, 'entryEmail');\n            Reflect.deleteProperty(person, 'emailAddress');\n          }\n\n          if (person.roomProperties) {\n            person.roomProperties.isModerator = Boolean(person.roomProperties.isModerator);\n          }\n\n          if (patterns.uuid.test(id)) {\n            person.entryUUID = person.id = id.toLowerCase();\n\n            return Promise.resolve(person);\n          }\n\n          if (!email) {\n            return Promise.reject(new Error('cannot determine id without an `emailAddress` or `entryUUID` property'));\n          }\n\n          return ctx.webex.internal.user.asUUID(email)\n            .then((uuid) => {\n              person.entryUUID = person.id = uuid;\n\n              return person;\n            });\n        }\n      }\n    ]\n      .concat(decryptionTransforms)\n      .concat(encryptionTransforms)\n  },\n  config\n});\n\nexport {default} from './conversation';\nexport {default as ShareActivity} from './share-activity';\nexport {ConversationError, InvalidUserCreation} from './convo-error';\n"]}