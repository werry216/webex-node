{"version":3,"sources":["detect-filetype.js"],"names":["detectFileType","file","logger","type","info","resolve","mimeType","then","name"],"mappings":";;;;;;;;;;;;;;AAIA;;AACA;;AALA;AACA;AACA;;AAKA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,cAAT,CAAwBC,IAAxB,EAA8BC,MAA9B,EAAsC;AACnD,MAAID,IAAI,CAACE,IAAT,EAAe;AACbD,IAAAA,MAAM,CAACE,IAAP,iCAAqCH,IAAI,CAACE,IAA1C;AAEA,WAAO,iBAAQE,OAAR,CAAgBJ,IAAI,CAACE,IAArB,CAAP;AACD;;AAED,MAAIF,IAAI,CAACK,QAAT,EAAmB;AACjBJ,IAAAA,MAAM,CAACE,IAAP,qCAAyCH,IAAI,CAACE,IAA9C;AAEA,WAAO,iBAAQE,OAAR,CAAgBJ,IAAI,CAACK,QAArB,CAAP;AACD,GAXkD,CAanD;AACA;;;AACA,SAAO,sBAAOL,IAAP,EACJM,IADI,CACC,UAACJ,IAAD,EAAU;AACd,QAAIA,IAAI,KAAK,mBAAT,IAAgCA,IAAI,KAAK,0BAA7C,EAAyE;AACvED,MAAAA,MAAM,CAACE,IAAP,mCAAuCD,IAAvC;AAEA,aAAO,mBAAQF,IAAI,CAACO,IAAb,CAAP;AACD;;AAEDN,IAAAA,MAAM,CAACE,IAAP,mCAAuCD,IAAvC;AAEA,WAAOA,IAAP;AACD,GAXI,CAAP;AAYD","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {detect} from '@webex/http-core';\nimport {getType} from 'mime';\n\n/**\n * Determines the file type of the specified file\n * @param {FileLike} file\n * @param {Object} logger\n * @returns {Promise<string>}\n */\nexport default function detectFileType(file, logger) {\n  if (file.type) {\n    logger.info(`file already has type ${file.type}. using existing file.type.`);\n\n    return Promise.resolve(file.type);\n  }\n\n  if (file.mimeType) {\n    logger.info(`file already has mimeType ${file.type}. using existing file.mimeType.`);\n\n    return Promise.resolve(file.mimeType);\n  }\n\n  // This kinda belongs in http core, but since we have no guarantee that\n  // buffers are expected to have names there, it'll stay here for now.\n  return detect(file)\n    .then((type) => {\n      if (type === 'application/x-msi' || type === 'application/octet-stream') {\n        logger.info(`detected filetype to be ${type}. Falling back to mime.lookup`);\n\n        return getType(file.name);\n      }\n\n      logger.info(`detected filetype to be ${type}. returning it`);\n\n      return type;\n    });\n}\n"]}