{"version":3,"sources":["response-logger.js"],"names":["ResponseLoggerInterceptor","options","response","now","Date","printResponseHeader","logger","console","process","env","ENABLE_VERBOSE_NETWORK_LOGGING","info","getTime","toISOString","body","util","inspect","depth","err","reason","error","reject","statusCode","$timings","networkEnd","networkStart","requestEnd","requestStart","webex","Interceptor"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport util from 'util';\n\nimport {get, omit} from 'lodash';\nimport {Interceptor} from '@webex/http-core';\nimport {isBuffer} from '@webex/common';\n\n/**\n * @class\n */\nexport default class ResponseLoggerInterceptor extends Interceptor {\n  /**\n   * @returns {ResponseLoggerInterceptor}\n   */\n  static create() {\n    return new ResponseLoggerInterceptor({webex: this});\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @param {HttpResponse} response\n   * @returns {Object}\n   */\n  onResponse(options, response) {\n    const now = new Date();\n\n    this.printResponseHeader(options, response);\n\n    const logger = get(this, 'webex.logger', console);\n\n    if (process.env.ENABLE_VERBOSE_NETWORK_LOGGING) {\n      logger.info('timestamp (end): ', now.getTime(), now.toISOString());\n      if (typeof response.body === 'string' || isBuffer(response.body)) {\n        logger.info('Response: ', 'Not printed, it`s probably a file');\n      }\n      else if (typeof response.body === 'object') {\n        try {\n          logger.info('Response: ', util.inspect(omit(response.body, 'features'), {depth: null}));\n        }\n        catch (err) {\n          logger.info('Response: ', '[Not Serializable]', err);\n        }\n      }\n    }\n    logger.info('\\\\**********************************************************************/');\n\n    return response;\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @param {Object} reason\n   * @returns {Object}\n   */\n  onResponseError(options, reason) {\n    const now = new Date();\n\n    this.printResponseHeader(options, reason);\n\n    const logger = get(this, 'webex.logger', console);\n\n    if (process.env.ENABLE_VERBOSE_NETWORK_LOGGING) {\n      logger.info('timestamp (end): ', now.getTime(), now.toISOString());\n      try {\n        logger.error('Response: ', util.inspect(reason.body, {depth: null}));\n      }\n      catch (err) {\n        logger.error('Response: ', reason.body);\n      }\n    }\n    logger.info('\\\\**********************************************************************/');\n\n    return Promise.reject(reason);\n  }\n\n  /**\n   * Prints the basic header\n   * @param {Object} options\n   * @param {HttpResponse|WebexHttpError} response\n   * @returns {undefined}\n   */\n  printResponseHeader(options, response) {\n    const logger = get(this, 'webex.logger', console);\n\n    logger.info('Status Code:', response.statusCode);\n    logger.info('WEBEX_TRACKINGID:', get(options, 'headers.trackingid') || get(response, 'headers.trackingid'));\n    logger.info('Network duration:', options.$timings.networkEnd - options.$timings.networkStart);\n    logger.info('Processing duration:', options.$timings.requestEnd - options.$timings.requestStart);\n  }\n}\n"]}