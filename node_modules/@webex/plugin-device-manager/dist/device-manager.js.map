{"version":3,"sources":["device-manager.js"],"names":["DeviceManager","WebexPlugin","extend","namespace","_devicePendingPinChallenge","_pairedDevice","_boundSpace","initialize","webex","internal","mercury","on","data","_receiveDeviceUpdates","getAll","DeviceCollection","refresh","reset","request","api","resource","then","res","body","reject","_updateDeviceMetadata","items","devices","forEach","device","deviceInfo","machineType","LYRA_SPACE","lyra","space","get","catch","err","logger","error","set","search","options","searchQuery","Error","people","searchId","uuid","v4","searchType","searchEntity","includePeople","includeRooms","queryString","upsert","deviceId","id","identity","existingDevice","resolve","method","auxDevice","_decryptDeviceName","token","getAdvertisedEndpoint","advertiser","result","displayName","remove","requestPin","url","dev","occupants","pinChallenge","info","join","passType","verificationInitiation","pair","pin","unpair","leave","bindSpace","kmsResourceObjectUrl","bindConversation","unbindSpace","unbindConversation","getAudioState","putAudioState","audioState","mute","unmute","increaseVolume","decreaseVolume","setVolume","level","deviceArray","length","all","map","index","services","waitForCatalog","deviceClass","UC_CLOUD","updatedDevice","inDevice","metadata","encryptedUserAssignedName","encryptionKeyUrl","encryption","decryptText","decryptedDeviceName","undefined","userAssignedName","spaceUrl","substring","lastIndexOf","self","verified","productName","DEFAULT_PRODUCT_NAME","pairedDeviceId"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\nimport {cloneDeep} from 'lodash';\nimport '@webex/internal-plugin-lyra';\nimport '@webex/internal-plugin-search';\nimport {WebexPlugin} from '@webex/webex-core';\nimport uuid from 'uuid';\n\nimport {LYRA_SPACE, UC_CLOUD, DEFAULT_PRODUCT_NAME} from './constants';\nimport DeviceCollection from './collection';\n\nconst DeviceManager = WebexPlugin.extend({\n  namespace: 'DeviceManager',\n  _devicePendingPinChallenge: null,\n  _pairedDevice: null,\n  _boundSpace: null,\n\n  initialize() {\n    // Lyra mercury events listener\n    this.webex.internal.mercury.on('event:lyra.space_updated', ({data}) => {\n      this._receiveDeviceUpdates(data);\n    });\n  },\n\n  /**\n  * Gets a list of all recent devices associated with the user\n  * the device list gets populated from Redis\n  * @returns {Promise<Device>}\n  */\n  getAll() {\n    return DeviceCollection.getAll();\n  },\n\n  /**\n  * Gets a list of all recent devices associated with the user\n  * the device list gets populated from Redis\n  * @returns {Promise<Device>}\n  */\n  refresh() {\n    DeviceCollection.reset();\n\n    return this.webex.request({\n      api: 'wdm',\n      resource: 'devices/auxiliary'\n    })\n      .then((res) => {\n        if (!res.body) {\n          return Promise.reject();\n        }\n\n        return this._updateDeviceMetadata(res.body.items)\n          .then((devices) => {\n            /* eslint-disable consistent-return */\n            devices.forEach((device) => {\n              if (device.deviceInfo &&\n                device.deviceInfo.machineType === LYRA_SPACE) {\n                return this.webex.internal.lyra.space.get(device.deviceInfo)\n                  .catch((err) => {\n                    this.logger.error('DeviceManager#refresh: failed to receive device info', err);\n                  });\n              }\n            });\n            /* eslint-enable consistent-return */\n            res.body.items.forEach((device) => {\n              DeviceCollection.set(device);\n            });\n\n            return this.getAll();\n          });\n      })\n      .catch((err) => {\n        this.logger.error('DeviceManager#refresh: failed to fetch recent devices', err);\n      });\n  },\n\n  /**\n  * Search for a device by name\n  * @param {Object} options\n  * @param {string} options.searchQuery\n  * @returns {Promise<Device>}\n  */\n  search(options) {\n    if (!options || !options.searchQuery) {\n      this.logger.error('DeviceManager#search: options.searchQuery is required');\n\n      return Promise.reject(new Error('DeviceManager#search: options.searchQuery is required'));\n    }\n\n    return this.webex.internal.search.people({\n      searchId: uuid.v4(),\n      searchType: 'DEVICE_SEARCH',\n      searchEntity: 'device',\n      includePeople: false,\n      includeRooms: true,\n      queryString: options.searchQuery\n    })\n      .catch((err) => {\n        this.logger.error('DeviceManager#search: failed to search a device', err);\n\n        throw err;\n      });\n  },\n\n  /**\n  * Caches the device info and also registers to Redis for subsequent fetches\n  * @param {Object} device\n  * @param {string} device.id\n  * @returns {deviceInfo}\n  */\n  upsert(device) {\n    const deviceId = device.id || device.identity && device.identity.id;\n\n    if (!deviceId) {\n      this.logger.error('DeviceManager#upsert: device.id is required');\n\n      return Promise.reject(new Error('DeviceManager#upsert: device.id is required'));\n    }\n    this._pairedDevice = this._devicePendingPinChallenge;\n    this._devicePendingPinChallenge = null;\n    // check if the device is already existing, if so then merge else add\n    const existingDevice = DeviceCollection.get(deviceId);\n\n    if (existingDevice) {\n      DeviceCollection.set(device);\n\n      return Promise.resolve(DeviceCollection.get(deviceId));\n    }\n\n    // new device requested, add to wdm for subsequent retreivals\n    return this.webex.request({\n      api: 'wdm',\n      method: 'PUT',\n      resource: `devices/auxiliary/Room/${deviceId}`\n    })\n      .then((res) => {\n        const auxDevice = res.body;\n\n        return this._decryptDeviceName(auxDevice);\n      })\n      .then((device) => {\n        DeviceCollection.set(device);\n\n        return Promise.resolve(DeviceCollection.get(deviceId));\n      })\n      .catch((err) => {\n        this.logger.error('DeviceManager#upsert: failed to add/update a device', err);\n\n        return Promise.reject(err);\n      });\n  },\n\n  /**\n  * Retreives device info of a particular device\n  * @param {string} token\n  * @returns {Promise<deviceInfo>}\n  */\n  get(token) {\n    if (!token) {\n      this.logger.error('DeviceManager#get: token is required');\n\n      return Promise.reject(new Error('DeviceManager#get: token is required'));\n    }\n    let deviceInfo;\n\n    return this.webex.internal.lyra.getAdvertisedEndpoint(token)\n      .then((res) => {\n        deviceInfo = res;\n\n        return this.webex.internal.lyra.space.get({id: res.advertiser.id});\n      })\n      .then((result) => {\n        // the deviceInfo doesn't have proper displayName, hence update\n        // displayName on deviceInfo for search to work\n        if (result && result.identity && result.identity.displayName) {\n          deviceInfo.advertiser.displayName = result.identity.displayName;\n        }\n\n        return deviceInfo;\n      })\n      .catch((err) => {\n        this.logger.error('DeviceManager#get: failed to get device info', err);\n\n        return Promise.reject(err);\n      });\n  },\n\n  /**\n  * Unregisters the device from Redis, will not fetch in subsequent loads,\n  * similar to space.deleteBinding()\n  * @param {string} deviceId\n  * @returns {Promise<deviceInfo>}\n  */\n  remove(deviceId) {\n    if (!deviceId) {\n      this.logger.error('DeviceManager#remove: deviceId is required');\n\n      return Promise.reject(new Error('DeviceManager#remove: deviceId is required'));\n    }\n\n    return this.webex.request({\n      method: 'delete',\n      api: 'wdm',\n      resource: `devices/auxiliary/${deviceId}`\n    })\n      .catch((error) => {\n        this.logger.error('DeviceManager#remove: failed to remove the device', error);\n\n        return Promise.reject(error);\n      });\n  },\n\n  /**\n  * Requests to display PIN on the device\n  * @param {object} device\n  * @param {object} options\n  * @param {object} options.data\n  * @returns {Promise<deviceInfo>}\n  */\n  requestPin(device, options = {}) {\n    const deviceId = device.id || device.identity && device.identity.id;\n\n    if (!deviceId) {\n      this.logger.error('DeviceManager#requestPin: device.id is required');\n\n      return Promise.reject(new Error('DeviceManager#requestPin: device.id is required'));\n    }\n    const space = {id: deviceId, url: `/spaces/${deviceId}`};\n\n    return this.webex.internal.lyra.space.get(space)\n      .then((dev) => { // check if the space is pinChallenge capable\n        if (dev && dev.occupants && dev.occupants.pinChallenge) {\n          this.logger.info('DeviceManager#requestPin: space is PIN challenge capable');\n\n          return this.webex.internal.lyra.space.join(space, {\n            passType: 'MANUAL',\n            verificationInitiation: 'PIN',\n            data: options.data\n          })\n            .then(() => {\n              this._devicePendingPinChallenge = dev;\n\n              // return the actual device so that it can be upserted on successful\n              // PIN exchange\n              return dev;\n            });\n        }\n        // pairs with the space if it's not PIN challenge capable\n        this.logger.info('DeviceManager#requestPin: space is not PIN challenge capable, probably already occupied, will still return device info');\n\n        return this.webex.internal.lyra.space.get(space)\n          .then(() => Promise.resolve(dev));\n      })\n      .catch((err) => {\n        this.logger.error('DeviceManager#requestPin: device failed PIN challenge request', err);\n\n        return Promise.reject(err);\n      });\n  },\n\n  /**\n  * pairs the device with the user (manual pairing), also adds it to\n  * user's recents list for subsequent fetches.\n  * similar to space.join()\n  * @param {object} options\n  * @param {number} options.pin\n  * @returns {Promise<deviceInfo>}\n  */\n  pair(options = {}) {\n    if (!options.pin) {\n      this.logger.error('DeviceManager#pair: options.pin is required');\n\n      return Promise.reject(new Error('DeviceManager#pair: options.pin is required'));\n    }\n    if (this._devicePendingPinChallenge) {\n      const space = {id: this._devicePendingPinChallenge.identity.id, url: `/spaces/${this._devicePendingPinChallenge.identity.id}`};\n\n      return this.webex.internal.lyra.space.join(space, {\n        passType: 'PIN_ANSWER',\n        data: options.pin\n      })\n        .catch((err) => {\n          this.logger.error('DeviceManager#pair: incorrect PIN, unable to pair ', err);\n\n          return Promise.reject(err);\n        })\n        .then(() => this.upsert(this._devicePendingPinChallenge));\n    }\n    this.logger.error('DeviceManager#pair: no device to pair');\n\n    return Promise.reject(new Error('DeviceManager#pair: no device to pair'));\n  },\n\n  /**\n  * unpairs the device with the user (manual/ultrasonic pairing), but still\n  * keeps in the recents list/does not remove from Redis\n  * options.removeAllDevices will remove all associated devices to user\n  * similar to space.leave()\n  * @param {object} options\n  * @param {boolean} options.removeAllDevices\n  * @returns {Promise<deviceInfo>}\n  */\n  unpair(options = {}) {\n    if (!this._pairedDevice) {\n      this.logger.error('DeviceManager#unpair: no device to unpair');\n\n      return Promise.reject(new Error('DeviceManager#unpair: no device to unpair'));\n    }\n    const space = {url: `/spaces/${this._pairedDevice.identity.id}`};\n\n    return this.webex.internal.lyra.space.leave(space, options)\n      .catch((err) => {\n        this.logger.error('DeviceManager#unpair: failed to remove device from Lyra', err);\n\n        return Promise.reject(err);\n      });\n  },\n\n  /**\n  * binds the space to the paired device (if supported)\n  * similar to space.bindConversation()\n  * @param {object} options\n  * @param {boolean} options.url, conversation url\n  * @param {boolean} options.kmsResourceObjectUrl of the convo\n  * @returns {Promise<deviceInfo>}\n  */\n  bindSpace(options = {}) {\n    if (!options.url) {\n      this.logger.error('DeviceManager#pair: options.url is required');\n\n      return Promise.reject(new Error('DeviceManager#bindSpace: options.url is required'));\n    }\n    if (!options.kmsResourceObjectUrl) {\n      this.logger.error('DeviceManager#bindSpace: options.kmsResourceObjectUrl is required');\n\n      return Promise.reject(new Error('DeviceManager#bindSpace: options.kmsResourceObjectUrl is required'));\n    }\n    if (!this._pairedDevice) {\n      this.logger.error('DeviceManager#bindSpace: No device paired currently');\n\n      return Promise.reject(new Error('DeviceManager#bindSpace: No device paired currently'));\n    }\n    const space = {url: `/spaces/${this._pairedDevice.identity.id}`, id: this._pairedDevice.identity.id};\n\n    this._boundSpace = {\n      kmsResourceObjectUrl: options.kmsResourceObjectUrl,\n      url: options.url\n    };\n\n    return this.webex.internal.lyra.space.bindConversation(space, this._boundSpace)\n      .catch((err) => {\n        this.logger.error('DeviceManager#bindSpace: failed to bind device to Space');\n\n        return Promise.reject(err);\n      });\n  },\n\n  /**\n  * unbinds the space to the paired device (if supported)\n  * similar to space.unbindConversation()\n  * @returns {Promise<deviceInfo>}\n  */\n  unbindSpace() {\n    if (!this._pairedDevice || !this._boundSpace) {\n      this.logger.error('DeviceManager#unbindSpace: No space currently bound to the device');\n\n      return Promise.reject(new Error('DeviceManager#unbindSpace: No space currently bound to the device'));\n    }\n    const space = {url: `/spaces/${this._pairedDevice.identity.id}`, id: this._pairedDevice.identity.id};\n\n    return this.webex.internal.lyra.space.unbindConversation(space, this._boundSpace)\n      .then((res) => {\n        this._boundSpace = null;\n\n        return Promise.resolve(res);\n      })\n      .catch((err) => {\n        this.logger.error('DeviceManager#unbindSpace: failed to unbind Space to device');\n\n        return Promise.reject(err);\n      });\n  },\n\n  /**\n  * Gets the audio state of the paired device\n  * similar to device.getAudioState()\n  * @returns {Promise<audioState>}\n  */\n  getAudioState() {\n    if (!this._pairedDevice) {\n      this.logger.error('DeviceManager#getAudioState: Currently no device is paired');\n\n      return Promise.reject(new Error('DeviceManager#getAudioState: Currently no device is paired'));\n    }\n\n    return this.webex.internal.lyra.device.getAudioState(this._pairedDevice);\n  },\n\n  /**\n  * Updates audio state of the paired device, should be called every 10 minutes\n  * or when mic or volume state is changed\n  * similar to device.putAudioState()\n  * @param {object} space\n  * @param {object} audioState\n  * @returns {Promise<audioState>}\n  */\n  putAudioState(space, audioState = {}) {\n    return this.webex.internal.lyra.device.putAudioState(space, audioState);\n  },\n\n  /**\n  * Mutes paired device\n  * similar to device.mute()\n  * @returns {Promise<audioState>}\n  */\n  mute() {\n    if (!this._pairedDevice) {\n      this.logger.error('DeviceManager#mute: Currently no device is paired');\n\n      return Promise.reject(new Error('DeviceManager#mute: Currently no device is paired'));\n    }\n\n    return this.webex.internal.lyra.device.mute(this._pairedDevice);\n  },\n\n  /**\n  * Unmutes paired device\n  * similar to device.unmute()\n  * @returns {Promise<audioState>}\n  */\n  unmute() {\n    if (!this._pairedDevice) {\n      this.logger.error('DeviceManager#unmute: Currently no device is paired');\n\n      return Promise.reject(new Error('DeviceManager#unmute: Currently no device is paired'));\n    }\n\n    return this.webex.internal.lyra.device.unmute(this._pairedDevice);\n  },\n\n  /**\n  * Increases paired device's volume\n  * similar to device.increaseVolume()\n  * @returns {Promise<audioState>}\n  */\n  increaseVolume() {\n    if (!this._pairedDevice) {\n      this.logger.error('DeviceManager#increaseVolume: Currently no device is paired');\n\n      return Promise.reject(new Error('DeviceManager#increaseVolume: Currently no device is paired'));\n    }\n\n    return this.webex.internal.lyra.device.increaseVolume(this._pairedDevice);\n  },\n\n  /**\n  * Decreases paired device's volume\n  * similar to device.decreaseVolume()\n  * @returns {Promise<audioState>}\n  */\n  decreaseVolume() {\n    if (!this._pairedDevice) {\n      this.logger.error('DeviceManager#decreaseVolume: Currently no device is paired');\n\n      return Promise.reject(new Error('DeviceManager#decreaseVolume: Currently no device is paired'));\n    }\n\n    return this.webex.internal.lyra.device.decreaseVolume(this._pairedDevice);\n  },\n\n  /**\n  * Sets paired device's volume but should use increase and decrease api instead\n  * similar to device.setVolume()\n  * @param {number} level\n  * @returns {Promise<audioState>}\n  */\n  setVolume(level = 0) {\n    if (!this._pairedDevice) {\n      this.logger.error('DeviceManager#setVolume: Currently no device is paired');\n\n      return Promise.reject(new Error('DeviceManager#setVolume: Currently no device is paired'));\n    }\n\n    return this.webex.internal.lyra.device.setVolume(this._pairedDevice, level);\n  },\n\n  /**\n  * Utility function to update decrypted device name on device object\n  * @param {Array} deviceArray\n  * @returns {device}\n  */\n  _updateDeviceMetadata(deviceArray = []) {\n    if (!deviceArray.length) {\n      return Promise.resolve(deviceArray);\n    }\n    const devices = cloneDeep(deviceArray);\n\n    return Promise.all(devices.map(\n      (device, index) => this.webex.internal.services.waitForCatalog('postauth')\n        .then(() => {\n          if (device.deviceClass === UC_CLOUD) {\n            device.id = `${this.webex.internal.services.get('wdm')}/${device.id}`;\n          }\n\n          return this._decryptDeviceName(device);\n        })\n        .then((updatedDevice) => {\n          devices[index] = updatedDevice;\n\n          return Promise.resolve();\n        })\n    ))\n      .then(() => Promise.resolve(devices));\n  },\n\n  /**\n  * Utility function to update decrypted device name on device object\n  * @param {object} inDevice\n  * @returns {device}\n  */\n  _decryptDeviceName(inDevice = {}) {\n    const device = cloneDeep(inDevice);\n\n    if (device.metadata &&\n      device.metadata.encryptedUserAssignedName &&\n      device.metadata.encryptionKeyUrl) {\n      return this.webex.internal.encryption.decryptText(\n        device.metadata.encryptionKeyUrl, device.metadata.encryptedUserAssignedName\n      )\n        .then((decryptedDeviceName) => {\n          // set userAssignedName as the decypted value, unset encryptedUserAssignedName since it's not needed\n          device.metadata.encryptedUserAssignedName = undefined;\n          device.metadata.userAssignedName = decryptedDeviceName;\n\n          return Promise.resolve(device);\n        })\n        .catch((err) => {\n          // unset encryptedUserAssignedName if failed to decrypt\n          device.metadata.encryptedUserAssignedName = undefined;\n          this.logger.error('DeviceCollection#_decryptDeviceName: failed to decrypt device name', err);\n        });\n    }\n\n    return Promise.resolve(device);\n  },\n\n  /**\n  * Utility function to update device info on mercury updates\n  * @param {object} device\n  * @returns {device}\n  */\n  _receiveDeviceUpdates(device) {\n    // we care only the updates are for the registered devices\n    if (device && device.spaceUrl) {\n      const deviceId = device.spaceUrl.substring(device.spaceUrl.lastIndexOf('/') + 1);\n      const existingDevice = DeviceCollection.get(deviceId);\n\n      if (existingDevice) {\n        return this.webex.internal.lyra.space.get({id: deviceId})\n          .then((space) => {\n            const device = DeviceCollection.get(deviceId);\n\n            if (device &&\n              space.occupants &&\n              (!space.occupants.self || !space.occupants.self.verified)) {\n              device.productName = space.devices && space.devices[0] && space.devices[0].productName ||\n              DEFAULT_PRODUCT_NAME;\n              // pin challenge is not verified reset _pairedDevice if ids\n              // match\n              const pairedDeviceId = this._pairedDevice && (this._pairedDevice.id || this._pairedDevice.identity.id);\n\n              if (pairedDeviceId === deviceId) {\n                this._pairedDevice = null;\n                this.logger.info(`DeviceManager#_receiveDeviceUpdates: device ${deviceId} lost pairing`);\n\n                return Promise.resolve();\n              }\n              // we do not want to reset the device pending PIN challenge\n              if (this._devicePendingPinChallenge.identity.id !== deviceId) {\n                return this.upsert(device);\n              }\n\n              return Promise.resolve();\n            }\n\n            return Promise.resolve();\n          })\n          .catch((err) => {\n            this.logger.error('DeviceManager#_receiveDeviceUpdates: failed to receive updates for Lyra space', err);\n          });\n      }\n    }\n\n    return Promise.resolve();\n  }\n\n\n});\n\nexport default DeviceManager;\n"]}