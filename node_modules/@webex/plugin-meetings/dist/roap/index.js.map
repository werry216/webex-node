{"version":3,"sources":["index.js"],"names":["Roap","attrs","options","meeting","roapMessage","messageType","ROAP","ROAP_TYPES","OFFER","sdps","sdp","version","ROAP_VERSION","seq","roapSeq","tieBreaker","roapHandler","submit","type","SEND_ROAP_MSG","msg","correlationId","roapBody","localMedias","localSdp","roapRequest","attachRechabilityData","audioMuted","isAudioMuted","videoMuted","isVideoMuted","MeetingUtil","joinMeetingOptions","then","locus","SEND_ROAP_MSG_SUCCESS","setRoapSeq","RoapHandler","sendRoapOK","bind","sendRoapAnswer","RoapRequest","lastRoapOffer","data","message","LoggerProxy","logger","log","RECEIVE_ROAP_MSG","RECEIVE_CALL_LEAVE","resolve","webex","meetings","meetingCollection","getByKey","OK","sendRoap","locusSelfUrl","selfUrl","mediaId","meetingId","id","ANSWER","session","errorType","ERROR","reconnect","StatelessWebexPlugin"],"mappings":"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","sourcesContent":["import {StatelessWebexPlugin} from '@webex/webex-core';\n\nimport {ROAP} from '../constants';\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport MeetingUtil from '../meeting/util';\n\nimport RoapHandler from './handler';\nimport RoapRequest from './request';\n\n/**\n * Roap options\n * @typedef {Object} RoapOptions\n * @property {String} sdp\n * @property {Meeting} meeting\n * @property {Number} roapSeq\n * @property {Boolean} reconnect\n */\n\n/**\n  * @typedef {Object} SeqOptions\n  * @property {String} correlationId\n  * @property {String} mediaId\n  * @property {Number} seq\n  */\n\n/**\n * @class Roap\n * @export\n * @private\n */\nexport default class Roap extends StatelessWebexPlugin {\n  /**\n   *\n   * @param {Object} attrs\n   * @param {Object} options\n   */\n  constructor(attrs, options) {\n    super({}, options);\n    /**\n     * @instance\n     * @type {Object}\n     * @private\n     * @memberof Roap\n     */\n    this.attrs = attrs;\n    /**\n     * @instance\n     * @type {Object}\n     * @private\n     * @memberof Roap\n     */\n    this.options = options;\n    /**\n     * The Roap Process State Handler\n     * @instance\n     * @type {RoapHandler}\n     * @private\n     * @memberof Roap\n     */\n    this.roapHandler = new RoapHandler(this.attrs, this.options, this.sendRoapOK.bind(this), this.sendRoapAnswer.bind(this));\n    /**\n     * The Roap Request Server Proxy Object\n     * @instance\n     * @type {RoapRequest}\n     * @private\n     * @memberof Roap\n     */\n    this.roapRequest = new RoapRequest({}, options);\n    /**\n     * The last roap offer sent to server and acked\n     * @instance\n     * @type {Object}\n     * @private\n     * @memberof Roap\n     */\n    this.lastRoapOffer = {};\n  }\n\n  /**\n   * Starts listening to mercury events for Roap messages\n   * @param {object} data event object\n   * @returns {Promise}\n   * @private\n   * @memberof Roap\n   */\n  roapEvent(data) {\n    const msg = data.message;\n    const {correlationId} = data;\n\n    LoggerProxy.logger.log(`Roap:index#roapEvent --> Received Roap Message [${JSON.stringify(msg, null, 2)}]`);\n    this.roapHandler.submit({\n      type: ROAP.RECEIVE_ROAP_MSG,\n      msg,\n      correlationId\n    });\n  }\n\n  /**\n   *\n   * @param {String} correlationId correlation id of a meeting\n   * @param {Number} seq ROAP sequence number\n   * @returns {Promise}\n   * @private\n   * @memberof Roap\n   */\n  stop(correlationId, seq) {\n    this.roapHandler.submit({\n      type: ROAP.RECEIVE_CALL_LEAVE,\n      seq,\n      correlationId\n    });\n\n    return Promise.resolve();\n  }\n\n  /**\n   *\n   * @param {SeqOptions} options\n   * @returns {null}\n   * @private\n   * @memberof Roap\n   */\n  sendRoapOK(options) {\n    return Promise.resolve().then(() => {\n      const meeting = this.webex.meetings.meetingCollection.getByKey('correlationId', options.correlationId);\n      const roapMessage = {\n        messageType: ROAP.ROAP_TYPES.OK,\n        version: ROAP.ROAP_VERSION,\n        seq: options.seq\n      };\n\n      LoggerProxy.logger.log(`Roap:index#sendRoapOK --> ROAP OK sending with seq ${options.seq}`);\n\n      return this.roapRequest\n        .sendRoap({\n          roapMessage,\n          locusSelfUrl: meeting.selfUrl,\n          mediaId: options.mediaId,\n          correlationId: options.correlationId,\n          audioMuted: meeting.isAudioMuted(),\n          videoMuted: meeting.isVideoMuted(),\n          meetingId: meeting.id\n        })\n        .then(() => {\n          this.roapHandler.submit({\n            type: ROAP.SEND_ROAP_MSG,\n            msg: roapMessage,\n            correlationId: options.correlationId\n          });\n          LoggerProxy.logger.log(`Roap:index#sendRoapOK --> ROAP OK sent with seq ${options.seq}`);\n          meeting.setRoapSeq(options.seq);\n        });\n    });\n  }\n\n  // eslint-disable-next-line no-warning-comments\n  // TODO: try to merge sendRoapOk and roapAnswer\n  /**\n   * Sends a ROAP answer...\n   * @param {SeqOptions} options\n   * @param {Boolean} options.audioMuted\n   * @param {Boolean} options.videoMuted\n   * @returns {Promise}\n   * @private\n   * @memberof Roap\n   */\n  sendRoapAnswer(options) {\n    const meeting = this.webex.meetings.meetingCollection.getByKey('correlationId', options.correlationId);\n    const roapMessage = {\n      messageType: ROAP.ROAP_TYPES.ANSWER,\n      sdps: options.sdps,\n      version: ROAP.ROAP_VERSION,\n      seq: options.seq\n    };\n\n    return this.roapRequest\n      .sendRoap({\n        roapMessage,\n        locusSelfUrl: meeting.selfUrl,\n        mediaId: options.mediaId,\n        correlationId: options.correlationId,\n        audioMuted: options.audioMuted,\n        videoMuted: options.videoMuted,\n        meetingId: meeting.id\n      })\n      .then(() => {\n        meeting.setRoapSeq(options.seq);\n        this.roapHandler.submit({\n          type: ROAP.SEND_ROAP_MSG,\n          msg: roapMessage,\n          correlationId: options.correlationId\n        });\n      });\n  }\n\n  /**\n   * Sends a ROAP error...\n   * @param {Object} session\n   * @param {Object} locus\n   * @param {String} errorType\n   * @returns {Promise}\n   * @private\n   * @memberof Roap\n   */\n  sendRoapError(session, locus, errorType) {\n    const msg = {\n      messageType: ROAP.ROAP_TYPES.ERROR,\n      version: ROAP.ROAP_VERSION,\n      errorType,\n      seq: session.OFFER.seq\n    };\n\n    return this.roapRequest.sendRoap(msg, locus);\n  }\n\n  /**\n   * sends a roap media request\n   * @param {RoapOptions} options\n   * @returns {Promise}\n   * @private\n   * @memberof Roap\n   */\n  sendRoapMediaRequest(options) {\n    const {meeting, reconnect} = options;\n    const roapMessage = {\n      messageType: ROAP.ROAP_TYPES.OFFER,\n      sdps: [options.sdp],\n      // sdps: [options.sdp],\n      version: ROAP.ROAP_VERSION,\n      seq: typeof options.roapSeq !== 'number' && Number.isNaN(parseFloat(options.roapSeq)) ? 0 : options.roapSeq + 1,\n      tieBreaker: 4294967294 // Math.floor(Math.random() * (2 ** 32) - 1) // TODO: Handle the roap  conflict scenario\n    };\n\n    this.roapHandler.submit({\n      type: ROAP.SEND_ROAP_MSG,\n      msg: roapMessage,\n      correlationId: meeting.correlationId\n    });\n\n    return this.roapRequest\n      .sendRoap({\n        roapMessage,\n        correlationId: meeting.correlationId,\n        locusSelfUrl: meeting.selfUrl,\n        mediaId: reconnect ? '' : meeting.mediaId,\n        audioMuted: meeting.isAudioMuted(),\n        videoMuted: meeting.isVideoMuted(),\n        meetingId: meeting.id\n      })\n      .then((locus) => {\n        this.roapHandler.submit({\n          type: ROAP.SEND_ROAP_MSG_SUCCESS,\n          seq: roapMessage.seq,\n          correlationId: meeting.correlationId\n        });\n        meeting.setRoapSeq(roapMessage.seq);\n\n        // eslint-disable-next-line no-warning-comments\n        // TODO: we need to attach peerconenction to locus not sure if we need to pass everything here\n        return locus;\n        // eslint-disable-next-line no-warning-comments\n        // TODO: check where to update the sequence number\n      });\n  }\n\n  /**\n   * sends a roap media request\n   * @param {RoapOptions} options\n   * @returns {Promise}\n   * @private\n   * @memberof Roap\n   */\nsendRoapCallRequest = (options) => {\n  const {meeting} = options;\n  const roapMessage = {\n    messageType: ROAP.ROAP_TYPES.OFFER,\n    sdps: [options.sdp],\n    version: ROAP.ROAP_VERSION,\n    seq: typeof options.roapSeq !== 'number' && Number.isNaN(parseFloat(options.roapSeq)) ? 0 : options.roapSeq + 1,\n    tieBreaker: 4294967294 // Math.floor(Math.random() * (2 ** 32) - 1) // TODO: Handle the roap  conflict scenario\n  };\n\n  this.roapHandler.submit({\n    type: ROAP.SEND_ROAP_MSG,\n    msg: roapMessage,\n    correlationId: meeting.correlationId\n  });\n\n  const roapBody = {\n    localMedias: [\n      {\n        localSdp: JSON.stringify(this.roapRequest.attachRechabilityData({\n          roapMessage,\n          // eslint-disable-next-line no-warning-comments\n          // TODO: check whats the need for video and audiomute\n          audioMuted: !!meeting.isAudioMuted(),\n          videoMuted: !!meeting.isVideoMuted()\n        }))\n        // mediaId: meeting.mediaId\n      }\n    ]\n  };\n\n  return MeetingUtil.joinMeetingOptions(meeting, {roapMessage: roapBody})\n    .then((locus) => {\n      this.roapHandler.submit({\n        type: ROAP.SEND_ROAP_MSG_SUCCESS,\n        seq: roapMessage.seq,\n        correlationId: meeting.correlationId\n      });\n      meeting.setRoapSeq(roapMessage.seq);\n\n      // eslint-disable-next-line no-warning-comments\n      // TODO: we need to attach peerconenction to locus not sure if we need to pass everything here\n      return locus;\n      // eslint-disable-next-line no-warning-comments\n      // TODO: check where to update the sequence number\n    });\n};\n}\n"]}