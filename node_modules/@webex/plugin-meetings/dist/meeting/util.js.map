{"version":3,"sources":["util.js"],"names":["MeetingUtil","parseLocusJoin","response","parsed","locus","body","mediaConnections","locusUrl","url","locusId","split","pop","selfId","self","id","forEach","mediaConnection","mediaId","remoteUpdateAudioVideo","audioMuted","videoMuted","meeting","reject","ParameterError","localMedias","Media","generateLocalMedias","Metrics","postEvent","event","eventType","MEDIA_REQUEST","meetingRequest","remoteAudioVideoToggle","deviceUrl","correlationId","then","MEDIA_RESPONSE","hasOwner","info","owner","isOwnerSelf","isPinOrGuest","err","errorCode","INTENT_TO_JOIN","joinMeeting","options","LOCAL_JOIN_REQUEST","sipUri","roapMessage","resourceId","moderator","pin","moveToResource","preferTranscoding","res","LOCUS_JOIN_RESPONSE","data","trigger","LOCI_UPDATE","trackingId","headers","trackingid","cleanUp","statsAnalyzer","stopAnalyzer","closeLocalStream","closeLocalShare","closeRemoteTracks","closePeerConnections","unsetLocalVideoTrack","unsetLocalShareTrack","unsetRemoteTracks","unsetPeerConnections","cleanMQAInterval","reconnectionManager","roap","stop","roapSeq","leaveMeeting","meetingState","FULL_STATE","INACTIVE","MeetingNotActiveError","isUserInLeftState","locusInfo","UserNotJoinedError","defaultOptions","leaveOptions","onFullLocus","resolve","moveMeeting","catch","LoggerProxy","logger","error","declineMeeting","reason","parsedLocus","state","_LEFT_","isUserInIdleState","_IDLE_","isUserInJoinedState","_JOINED_","isMediaEstablished","currentMediaStatus","audio","video","share","joinMeetingOptions","PIN_COLLECTED","setLocus","meetingInfo","PIN_PROMPT","IntentToJoinError","JoinMeetingError","updateTransceiver","meetingOptions","type","sendTrack","receiveTrack","track","transceiver","peerConnection","previousMediaDirection","undefined","meetingId","remoteQualityLevel","mediaProperties","enableRtx","config","sendRoapMediaRequest","sdp","e","sender","replaceTrack","validateOptions","sendVideo","sendAudio","sendShare","localStream","localShare","getTrack","videoTrack","audioTrack","stream","audioTracks","videoTracks","getAudioTracks","getVideoTracks","length","getModeratorFromLocusInfo","getPolicyFromLocusInfo","policy","canUserLock","joined","LOCK_CONTROL_LOCK","LOCK_STATUS_UNLOCKED","canUserUnlock","LOCK_CONTROL_UNLOCK","LOCK_STATUS_LOCKED","canUserRecord","RECORDING_CONTROL_START","canUserPause","RECORDING_CONTROL_PAUSE","canUserResume","RECORDING_CONTROL_RESUME","canUserStop","RECORDING_CONTROL_STOP","startRecording","request","recordMeeting","recording","paused","PermissionError","pauseRecording","resumeRecording","stopRecording","lockMeeting","actions","canLock","lock","unlockMeeting","canUnlock","startInternalStats","internalStats","useConfig","senders","correlate","history","onEvent","kind","stat","Trigger","file","function","EVENT_TRIGGERS","MEETING_MEDIA_LOCAL_STARTED","mediaType","AUDIO","SENDING_MEDIA_START","SENDING_MEDIA_STOP","onData","VIDEO","SHARE","SENDING_SHARE_START","SENDING_SHARE_STOP","receivers","MEETING_MEDIA_REMOTE_STARTED","RECEIVING_MEDIA_START","RECEIVING_MEDIA_STOP","StatsUtil","generateOptions","STATS","CONFIG","WebRTCStats","attrs"],"mappings":"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","sourcesContent":["import {isEmpty} from 'lodash';\n\nimport {MeetingNotActiveError, UserNotJoinedError} from '../common/errors/webex-errors';\nimport StatsUtil from '../stats/util';\nimport Metrics from '../metrics';\nimport {eventType, trigger, mediaType} from '../metrics/config';\nimport Media from '../media';\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport WebRTCStats from '../stats/index';\nimport {INTENT_TO_JOIN,\n  _LEFT_,\n  _IDLE_,\n  _JOINED_,\n  STATS,\n  EVENT_TRIGGERS\n  , FULL_STATE} from '../constants';\nimport Trigger from '../common/events/trigger-proxy';\nimport IntentToJoinError from '../common/errors/intent-to-join';\nimport JoinMeetingError from '../common/errors/join-meeting';\nimport ParameterError from '../common/errors/parameter';\nimport PermissionError from '../common/errors/permission';\n\n\nconst MeetingUtil = {};\n\nMeetingUtil.parseLocusJoin = (response) => {\n  const parsed = {};\n\n  // First todo: add check for existance\n  parsed.locus = response.body.locus;\n  parsed.mediaConnections = response.body.mediaConnections;\n  parsed.locusUrl = parsed.locus.url;\n  parsed.locusId = parsed.locus.url.split('/').pop();\n  parsed.selfId = parsed.locus.self.id;\n\n  // we need mediaId before making roap calls\n  parsed.mediaConnections.forEach((mediaConnection) => {\n    if (mediaConnection.mediaId) {\n      parsed.mediaId = mediaConnection.mediaId;\n    }\n  });\n\n  return parsed;\n};\n\nMeetingUtil.remoteUpdateAudioVideo = (audioMuted, videoMuted, meeting) => {\n  if (!meeting) {\n    return Promise.reject(new ParameterError('You need a meeting object.'));\n  }\n  const localMedias = Media.generateLocalMedias(meeting.mediaId, audioMuted, videoMuted);\n\n  if (isEmpty(localMedias)) {\n    return Promise.reject(new ParameterError('You need a media id on the meeting to change remote audio.'));\n  }\n\n  Metrics.postEvent({event: eventType.MEDIA_REQUEST, meeting});\n\n  return meeting.meetingRequest.remoteAudioVideoToggle({\n    locusUrl: meeting.locusUrl,\n    selfId: meeting.selfId,\n    localMedias,\n    deviceUrl: meeting.deviceUrl,\n    correlationId: meeting.correlationId\n  }).then((response) => {\n    Metrics.postEvent({event: eventType.MEDIA_RESPONSE, meeting});\n\n    return response.body.locus;\n  });\n};\n\nMeetingUtil.hasOwner = (info) => info && info.owner;\n\nMeetingUtil.isOwnerSelf = (owner, selfId) => owner === selfId;\n\nMeetingUtil.isPinOrGuest = (err) => {\n  if (err && err.body && err.body.errorCode === INTENT_TO_JOIN) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.joinMeeting = (meeting, options) => {\n  if (!meeting) {\n    return Promise.reject(new ParameterError('You need a meeting object.'));\n  }\n\n  Metrics.postEvent({event: eventType.LOCAL_JOIN_REQUEST, meeting});\n\n  // eslint-disable-next-line no-warning-comments\n  // TODO: check if the meeting is in JOINING state\n  // if Joining state termintate the request as user might click multiple times\n  return meeting.meetingRequest\n    .joinMeeting({\n      sipUri: meeting.sipUri,\n      deviceUrl: meeting.deviceUrl,\n      locusUrl: meeting.locusUrl,\n      correlationId: meeting.correlationId,\n      roapMessage: options.roapMessage,\n      resourceId: options.resourceId || null,\n      moderator: options.moderator,\n      pin: options.pin,\n      moveToResource: options.moveToResource,\n      preferTranscoding: options.preferTranscoding\n    })\n    .then((res) => {\n      Metrics.postEvent({\n        event: eventType.LOCUS_JOIN_RESPONSE,\n        meeting,\n        data: {\n          trigger: trigger.LOCI_UPDATE,\n          locus: res.body.locus,\n          trackingId: res.headers.trackingid\n        }\n      });\n\n      return MeetingUtil.parseLocusJoin(res);\n    });\n};\n\nMeetingUtil.cleanUp = (meeting) => {\n  // make sure we send last metrics before we close the peerconnection\n  if (meeting.statsAnalyzer) meeting.statsAnalyzer.stopAnalyzer();\n\n  return meeting.closeLocalStream()\n    .then(() => meeting.closeLocalShare())\n    .then(() => meeting.closeRemoteTracks())\n    .then(() => meeting.closePeerConnections())\n    .then(() => {\n      meeting.unsetLocalVideoTrack();\n      meeting.unsetLocalShareTrack();\n      meeting.unsetRemoteTracks();\n      meeting.unsetPeerConnections();\n      meeting.cleanMQAInterval();\n      meeting.reconnectionManager.cleanUp();\n    })\n    .then(() => meeting.roap.stop(meeting.correlationId, meeting.roapSeq));\n};\n\n// by default will leave on meeting's resourceId\n// if you explicity want it not to leave on resource id, pass\n// {resourceId: null}\n// TODO: chris, you can modify this however you want\nMeetingUtil.leaveMeeting = (meeting, options = {}) => {\n  if (meeting.meetingState === FULL_STATE.INACTIVE) {\n    // TODO: clean up if the meeting is already inactive\n    return Promise.reject(new MeetingNotActiveError());\n  }\n\n  if (MeetingUtil.isUserInLeftState(meeting.locusInfo)) {\n    return Promise.reject(new UserNotJoinedError());\n  }\n\n  const defaultOptions = {\n    locusUrl: meeting.locusUrl,\n    selfId: meeting.selfId,\n    correlationId: meeting.correlationId,\n    resourceId: meeting.resourceId,\n    deviceUrl: meeting.deviceUrl\n  };\n\n  const leaveOptions = {...defaultOptions, ...options};\n\n  return meeting.meetingRequest\n    .leaveMeeting(leaveOptions)\n    .then((response) => {\n      if (response && response.body && response.body.locus) { // && !options.moveMeeting) {\n        meeting.locusInfo.onFullLocus(response.body.locus);\n      }\n\n      return Promise.resolve();\n    })\n    .then(() => {\n      if (options.moveMeeting) {\n        return Promise.resolve();\n      }\n\n      return MeetingUtil.cleanUp(meeting);\n    })\n    .catch((err) => {\n      // TODO: If the meeting state comes as LEFT or INACTIVE as response then\n      // 1)  on leave clean up the meeting or simply do a sync on the meeting\n      // 2) If the error says meeting is inactive then destroy the meeting object\n      LoggerProxy.logger.error(\n        `Meeting:util#leaveMeeting --> An error occured while trying to leave meeting with an id of ${\n          meeting.id\n        }, error: ${err}`\n      );\n\n      return Promise.reject(err);\n    });\n};\nMeetingUtil.declineMeeting = (meeting, reason) =>\n  meeting.meetingRequest.declineMeeting({\n    locusUrl: meeting.locusUrl,\n    deviceUrl: meeting.deviceUrl,\n    reason\n  });\n\nMeetingUtil.isUserInLeftState = (locusInfo) =>\n   locusInfo.parsedLocus?.self?.state === _LEFT_;\n\nMeetingUtil.isUserInIdleState = (locusInfo) =>\n   locusInfo.parsedLocus?.self?.state === _IDLE_;\n\nMeetingUtil.isUserInJoinedState = (locusInfo) =>\n  locusInfo.parsedLocus?.self?.state === _JOINED_;\n\nMeetingUtil.isMediaEstablished = (currentMediaStatus) =>\n  currentMediaStatus && (currentMediaStatus.audio || currentMediaStatus.video || currentMediaStatus.share);\n\n\nMeetingUtil.joinMeetingOptions = (meeting, options = {}) => {\n  meeting.resourceId = meeting.resourceId || options.resourceId;\n\n  if (options.pin) {\n    Metrics.postEvent({\n      event: eventType.PIN_COLLECTED,\n      meeting\n    });\n  }\n\n  // normal join meeting, scenario A, D\n  return MeetingUtil.joinMeeting(meeting, options)\n    .then((response) => {\n      meeting.setLocus(response);\n\n      return Promise.resolve(response);\n    })\n    .catch((err) => {\n      // joining a claimed PMR that is not my own, scenario B\n      if (MeetingUtil.isPinOrGuest(err)) {\n        if (MeetingUtil.hasOwner(meeting.meetingInfo)) {\n          return MeetingUtil.joinMeeting(meeting, options).then((response) => {\n            meeting.setLocus(response);\n\n            return Promise.resolve();\n          });\n        }\n\n        Metrics.postEvent({\n          event: eventType.PIN_PROMPT,\n          meeting\n        });\n\n        // request host pin or non host for unclaimed PMR, start of Scenario C\n        // see https://sqbu-github.cisco.com/WebExSquared/locus/wiki/Locus-Lobby-and--IVR-Feature\n        return Promise.reject(new IntentToJoinError('Error Joining Meeting', err));\n      }\n      LoggerProxy.logger.error('Meeting:util#joinMeetingOptions --> Error joining the call, ', err);\n\n      return Promise.reject(new JoinMeetingError(options, 'Error Joining Meeting', err));\n    });\n};\n\nMeetingUtil.updateTransceiver = (options, meetingOptions) => {\n  const {\n    type,\n    sendTrack,\n    receiveTrack,\n    track,\n    transceiver,\n    peerConnection,\n    previousMediaDirection\n  } = options;\n\n  if ((sendTrack !== undefined && sendTrack !== previousMediaDirection.sendTrack) ||\n  (receiveTrack !== undefined && receiveTrack !== previousMediaDirection.receiveTrack)) {\n    return Media.updateTransceiver({\n      meetingId: meetingOptions.meeting.id,\n      remoteQualityLevel: meetingOptions.mediaProperties.remoteQualityLevel,\n      enableRtx: meetingOptions.meeting.config.enableRtx\n    }, peerConnection, transceiver,\n    {\n      track,\n      type,\n      receiveTrack,\n      sendTrack\n    })\n      .then(() => meetingOptions.meeting.roap\n        .sendRoapMediaRequest({\n          sdp: meetingOptions.mediaProperties.peerConnection.sdp,\n          roapSeq: meetingOptions.roapSeq,\n          meeting: meetingOptions.meeting // or can pass meeting ID\n        }))\n      .catch((e) => {\n        LoggerProxy.logger.error(`Meeting:util#updateTransceiver --> Error updating the ${type} streams with error: ${e}`);\n      });\n  } if (track) {\n    transceiver.sender.replaceTrack(track);\n\n    return Promise.resolve();\n  }\n\n  return Promise.reject(new ParameterError('update Failed: please pass valid parameter'));\n};\n\nMeetingUtil.validateOptions = (options) => {\n  const {\n    sendVideo, sendAudio, sendShare, localStream, localShare\n  } = options;\n\n  if (sendVideo && !MeetingUtil.getTrack(localStream).videoTrack) {\n    return Promise.reject(new ParameterError('please pass valid video streams'));\n  }\n\n  if (sendAudio && !MeetingUtil.getTrack(localStream).audioTrack) {\n    return Promise.reject(new ParameterError('please pass valid audio streams'));\n  }\n\n  if (sendShare && !MeetingUtil.getTrack(localShare).videoTrack) {\n    return Promise.reject(new ParameterError('please pass valid share streams'));\n  }\n\n  return Promise.resolve();\n};\n\nMeetingUtil.getTrack = (stream) => {\n  let audioTrack = null;\n  let videoTrack = null;\n  let audioTracks = null;\n  let videoTracks = null;\n\n  if (!stream) {\n    return {audioTrack: null, videoTrack: null};\n  }\n  if (stream.getAudioTracks) {\n    audioTracks = stream.getAudioTracks();\n  }\n  if (stream.getVideoTracks) {\n    videoTracks = stream.getVideoTracks();\n  }\n\n  if (audioTracks && audioTracks.length > 0) {\n    [audioTrack] = audioTracks;\n  }\n\n  if (videoTracks && videoTracks.length > 0) {\n    [videoTrack] = videoTracks;\n  }\n\n  return {audioTrack, videoTrack};\n};\n\nMeetingUtil.getModeratorFromLocusInfo = (locusInfo) =>\n  locusInfo &&\n  locusInfo.parsedLocus &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info.moderator;\n\nMeetingUtil.getPolicyFromLocusInfo = (locusInfo) =>\n  locusInfo &&\n  locusInfo.parsedLocus &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info.policy;\n\nMeetingUtil.canUserLock = (moderator, joined) => {\n  if (moderator.LOCK_CONTROL_LOCK && joined.LOCK_STATUS_UNLOCKED) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.canUserUnlock = (moderator, joined) => {\n  if (moderator.LOCK_CONTROL_UNLOCK && joined.LOCK_STATUS_LOCKED) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.canUserRecord = (moderator) => moderator.RECORDING_CONTROL_START;\n\nMeetingUtil.canUserPause = (moderator) => moderator.RECORDING_CONTROL_PAUSE;\n\nMeetingUtil.canUserResume = (moderator) => moderator.RECORDING_CONTROL_RESUME;\n\nMeetingUtil.canUserStop = (moderator) => moderator.RECORDING_CONTROL_STOP;\n\nMeetingUtil.startRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserRecord(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Start recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.pauseRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserPause(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: true});\n  }\n\n  return Promise.reject(new PermissionError('Pause recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.resumeRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserResume(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Resume recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.stopRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserStop(moderator)) {\n    return request.recordMeeting({locusUrl, recording: false, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Stop recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.lockMeeting = (actions, request, locusUrl) => {\n  if (actions && actions.canLock) {\n    return request.lockMeeting({locusUrl, lock: true});\n  }\n\n  return Promise.reject(new PermissionError('Lock not allowed, due to joined property.'));\n};\n\nMeetingUtil.unlockMeeting = (actions, request, locusUrl) => {\n  if (actions && actions.canUnlock) {\n    return request.lockMeeting({locusUrl, lock: false});\n  }\n\n  return Promise.reject(new PermissionError('Unlock not allowed, due to joined property.'));\n};\n\nMeetingUtil.startInternalStats = (meeting) => {\n  if (!meeting.internalStats) {\n    const options = {\n      useConfig: true,\n      senders: [\n        {\n          id: 'mainAudio',\n          correlate: 'audio',\n          history: true,\n          onEvent: (event) => {\n            // TODO: we don't need checks like this since it comes from the transceiver\n            // refactor event linkage to use callbacks instead of events\n            if (event.kind === 'audio' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.AUDIO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainVideo',\n          correlate: 'video',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'video' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.VIDEO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainShare',\n          correlate: 'video',\n          onEvent: (event) => {\n            if (event.kind === 'share' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.SHARE\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_SHARE_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_SHARE_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n          },\n          onData: () => {}\n        }\n      ],\n      receivers: [\n        {\n          id: 'mainAudio',\n          correlate: 'audio',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'audio' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.AUDIO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainVideo',\n          correlate: 'video',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'video' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.VIDEO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainShare',\n          correlate: 'video',\n          onEvent: (event) => {\n            if (event.kind === 'share' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.SHARE\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n          },\n          onData: () => {}\n        }\n      ]\n    };\n\n    StatsUtil.generateOptions(options, STATS.CONFIG, meeting);\n\n    options.config = STATS.CONFIG;\n\n    // pass the attrs and options for the webex instance\n    meeting.internalStats = new WebRTCStats(meeting.attrs, meeting.options, options);\n  }\n\n  return meeting.internalStats;\n};\n\nexport default MeetingUtil;\n"]}