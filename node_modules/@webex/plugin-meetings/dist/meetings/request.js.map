{"version":3,"sources":["request.js"],"names":["MeetingRequest","request","api","API","LOCUS","resource","RESOURCE","LOCI","then","res","determineRedirections","body","catch","error","LoggerProxy","logger","webex","internal","services","fetchClientRegionInfo","responseBody","remoteLocusClusterUrls","length","all","map","url","method","HTTP_VERBS","GET","runWhitelistedDomains","loci","concat","locusUrls","resolve","StatelessWebexPlugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AACA;;;;;;AAMA;AACA;AACA;IACqBA,c;;;;;;;;;;;;;AACnB;AACF;AACA;AACA;AACE,iCAAoB;AAAA;;AAClB,aAAO,KAAKC,OAAL,CAAa;AAClBC,QAAAA,GAAG,EAAEC,eAAIC,KADS;AAElBC,QAAAA,QAAQ,EAAEC,oBAASC;AAFD,OAAb,EAIJC,IAJI,CAIC,UAACC,GAAD;AAAA,eAAS,KAAI,CAACC,qBAAL,CAA2BD,GAAG,CAACE,IAA/B,CAAT;AAAA,OAJD,EAKJC,KALI,CAKE,UAACC,KAAD,EAAW;AAChBC,6BAAYC,MAAZ,CAAmBF,KAAnB,+EAAgGA,KAAhG;AACD,OAPI,CAAP;AAQD;AAED;AACF;AACA;AACA;;;;WACE,wBAAe;AACb,aAAO,KAAKG,KAAL,CAAWC,QAAX,CAAoBC,QAApB,CAA6BC,qBAA7B,EAAP;AACD,K,CAED;;AAEA;AACF;AACA;AACA;AACA;;;;WACE,+BAAsBC,YAAtB,EAAoC;AAAA;;AAClC,UAAIA,YAAY,CAACC,sBAAb,IAAuCD,YAAY,CAACC,sBAAb,CAAoCC,MAA/E,EAAuF;AACrF,eAAO,iBAAQC,GAAR,CAAYH,YAAY,CAACC,sBAAb,CAAoCG,GAApC,CAAwC,UAACC,GAAD;AAAA,iBAAS,MAAI,CAACxB,OAAL,CAAa;AAC/EyB,YAAAA,MAAM,EAAEC,sBAAWC,GAD4D;AAE/EH,YAAAA,GAAG,EAAHA,GAF+E;AAG/EI,YAAAA,qBAAqB,EAAE,IAHwD,CAGnD;;AAHmD,WAAb,EAKjErB,IALiE,CAK5D,UAACC,GAAD,EAAS;AACbW,YAAAA,YAAY,CAACU,IAAb,GAAoBV,YAAY,CAACU,IAAb,CAAkBC,MAAlB,CAAyBtB,GAAG,CAACE,IAAJ,CAASmB,IAAlC,CAApB;AACAV,YAAAA,YAAY,CAACY,SAAb,GAAyBZ,YAAY,CAACY,SAAb,CAAuBD,MAAvB,CAA8BtB,GAAG,CAACE,IAAJ,CAASqB,SAAvC,CAAzB;AAEA,mBAAO,iBAAQC,OAAR,CAAgBb,YAAhB,CAAP;AACD,WAViE,EAWjER,KAXiE,CAW3D,UAACC,KAAD,EAAW;AAChBC,iCAAYC,MAAZ,CAAmBF,KAAnB,4FAA6GY,GAA7G,uBAA6HZ,KAA7H;AACD,WAbiE,CAAT;AAAA,SAAxC,CAAZ,EAcJL,IAdI,CAcC;AAAA,iBAAM,iBAAQyB,OAAR,CAAgBb,YAAhB,CAAN;AAAA,SAdD,CAAP;AAeD;;AAED,aAAO,iBAAQa,OAAR,CAAgBb,YAAhB,CAAP;AACD;;;EAnDyCc,+B","sourcesContent":["import {StatelessWebexPlugin} from '@webex/webex-core';\n\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport {\n  HTTP_VERBS,\n  API,\n  RESOURCE\n} from '../constants';\n\n/**\n * @class MeetingRequest\n */\nexport default class MeetingRequest extends StatelessWebexPlugin {\n  /**\n     *  get all the active meetings for the user\n     * @returns {Array} return locus array\n    */\n  getActiveMeetings() {\n    return this.request({\n      api: API.LOCUS,\n      resource: RESOURCE.LOCI\n    })\n      .then((res) => this.determineRedirections(res.body))\n      .catch((error) => {\n        LoggerProxy.logger.error(`Meetings:request#getActiveMeetings --> failed to get locus details, ${error}`);\n      });\n  }\n\n  /**\n     *  fetch geoHit for the user\n     * @returns {Promise<object>} geoHintInfo\n    */\n  fetchGeoHint() {\n    return this.webex.internal.services.fetchClientRegionInfo();\n  }\n\n  // locus federation, determines and populate locus if the responseBody has remote URLs to fetch locus details\n\n  /**\n   *  Fetches indivdual locus rather then getting all at once\n   * @param {object} responseBody determine the locus and fetch them if a remoteUrl is given\n   * @returns {Promise}  returns locusObject array\n   */\n  determineRedirections(responseBody) {\n    if (responseBody.remoteLocusClusterUrls && responseBody.remoteLocusClusterUrls.length) {\n      return Promise.all(responseBody.remoteLocusClusterUrls.map((url) => this.request({\n        method: HTTP_VERBS.GET,\n        url,\n        runWhitelistedDomains: true // allows auth token for whitelisted domain\n      })\n        .then((res) => {\n          responseBody.loci = responseBody.loci.concat(res.body.loci);\n          responseBody.locusUrls = responseBody.locusUrls.concat(res.body.locusUrls);\n\n          return Promise.resolve(responseBody);\n        })\n        .catch((error) => {\n          LoggerProxy.logger.error(`Meetings:request#determineRedirections --> failed to get locus details from url: ${url}, reason: ${error}`);\n        })))\n        .then(() => Promise.resolve(responseBody));\n    }\n\n    return Promise.resolve(responseBody);\n  }\n}\n"]}