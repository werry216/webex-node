{"version":3,"sources":["html.shim.js"],"names":["removeNode","node","remove","parentElement","removeChild","i","length","Error","_filter","args","resolve","_filterSync","filter","processCallback","allowedTags","allowedStyles","html","doc","DOMParser","parseFromString","depthFirstForEach","body","childNodes","filterNode","indexOf","innerHTML","isElement","nodeName","toLowerCase","allowedTagNames","allowedAttributes","listAttributeNames","attributes","attrName","removeAttribute","attrValue","getNamedItem","value","trim","reparent","styles","split","map","style","styleName","Boolean","join","setAttribute","_filterEscape","_filterEscapeSync","escapeNode","before","document","createTextNode","after","parentNode","insertBefore","trimPattern","str","replace","attrNames","attr","push","name","list","fn","o","ownerDocument","undefined","nodeType","filterSync","filterEscape","filterEscapeSync"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\nimport {curry, forEach, includes, reduce} from 'lodash';\n\nexport {escape, escapeSync} from './html-base';\n\n/**\n * Some browsers don't implement {@link Element#remove()} or\n * {@link NodeList#remove()} or {@link HTMLCollection#remove()}. This wrapper\n * calls the appropriate `#remove()` method if available, or falls back to a\n * non-global-polluting polyfill.\n * @param {Element|NodeList|HTMLCollection} node\n * @returns {undefined}\n */\nfunction removeNode(node) {\n  if (node.remove) {\n    node.remove();\n\n    return;\n  }\n\n  if (node.parentElement) {\n    node.parentElement.removeChild(node);\n\n    return;\n  }\n\n  if ('length' in node) {\n    for (let i = node.length - 1; i >= 0; i -= 1) {\n      removeNode(node[i]);\n    }\n\n    return;\n  }\n\n  throw new Error('Could not find a way to remove node');\n}\n\n/**\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @private\n * @returns {string}\n */\nfunction _filter(...args) {\n  return new Promise((resolve) => {\n    resolve(_filterSync(...args));\n  });\n}\n\n/**\n * Curried async HTML filter.\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\nexport const filter = curry(_filter, 4);\n\n/**\n * @param {function} processCallback callback function to do additional\n * processing on node. of the form process(node)\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @private\n * @returns {string}\n */\nfunction _filterSync(processCallback, allowedTags, allowedStyles, html) {\n  if (!html || !allowedStyles || !allowedTags) {\n    if (html.length === 0) {\n      return html;\n    }\n\n    throw new Error('`allowedTags`, `allowedStyles`, and `html` must be provided');\n  }\n\n  const doc = (new DOMParser()).parseFromString(html, 'text/html');\n\n  depthFirstForEach(doc.body.childNodes, filterNode);\n  processCallback(doc.body);\n\n  if (html.indexOf('body') === 1) {\n    return `<body>${doc.body.innerHTML}</body>`;\n  }\n\n  return doc.body.innerHTML;\n\n  /**\n   * @param {Node} node\n   * @private\n   * @returns {undefined}\n   */\n  function filterNode(node) {\n    if (!isElement(node)) {\n      return;\n    }\n\n    const nodeName = node.nodeName.toLowerCase();\n    const allowedTagNames = Object.keys(allowedTags);\n\n    depthFirstForEach(node.childNodes, filterNode);\n\n    if (includes(allowedTagNames, nodeName)) {\n      const allowedAttributes = allowedTags[nodeName];\n\n      forEach(listAttributeNames(node.attributes), (attrName) => {\n        if (!includes(allowedAttributes, attrName)) {\n          node.removeAttribute(attrName);\n        }\n        else if (attrName === 'href' || attrName === 'src') {\n          const attrValue = node.attributes.getNamedItem(attrName).value.trim().toLowerCase();\n\n          // We're doing at runtime what the no-script-url rule does at compile\n          // time\n          // eslint-disable-next-line no-script-url\n          if (attrValue.indexOf('javascript:') === 0 || attrValue.indexOf('vbscript:') === 0) {\n            reparent(node);\n          }\n        }\n        else if (attrName === 'style') {\n          const styles = node\n            .attributes\n            .getNamedItem('style')\n            .value\n            .split(';')\n            .map((style) => {\n              const styleName = trim(style.split(':')[0]);\n\n              if (includes(allowedStyles, styleName)) {\n                return style;\n              }\n\n              return null;\n            })\n            .filter((style) => Boolean(style))\n            .join(';');\n\n          node.setAttribute('style', styles);\n        }\n      });\n    }\n    else {\n      reparent(node);\n    }\n  }\n}\n\n/**\n * Same as _filter, but escapes rather than removes disallowed values\n * @param {Function} processCallback\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @returns {Promise<string>}\n */\nfunction _filterEscape(...args) {\n  return new Promise((resolve) => {\n    resolve(_filterEscapeSync(...args));\n  });\n}\n\n/**\n * Same as _filterSync, but escapes rather than removes disallowed values\n * @param {Function} processCallback\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @returns {string}\n */\nfunction _filterEscapeSync(processCallback, allowedTags, allowedStyles, html) {\n  if (!html || !allowedStyles || !allowedTags) {\n    if (html.length === 0) {\n      return html;\n    }\n\n    throw new Error('`allowedTags`, `allowedStyles`, and `html` must be provided');\n  }\n\n  const doc = (new DOMParser()).parseFromString(html, 'text/html');\n\n  depthFirstForEach(doc.body.childNodes, filterNode);\n  processCallback(doc.body);\n\n  if (html.indexOf('body') === 1) {\n    return `<body>${doc.body.innerHTML}</body>`;\n  }\n\n  return doc.body.innerHTML;\n\n  /**\n   * @param {Node} node\n   * @private\n   * @returns {undefined}\n   */\n  function filterNode(node) {\n    if (!isElement(node)) {\n      return;\n    }\n\n    depthFirstForEach(node.childNodes, filterNode);\n\n    const nodeName = node.nodeName.toLowerCase();\n    const allowedTagNames = Object.keys(allowedTags);\n\n    if (includes(allowedTagNames, nodeName)) {\n      const allowedAttributes = allowedTags[nodeName];\n\n      forEach(listAttributeNames(node.attributes), (attrName) => {\n        if (!includes(allowedAttributes, attrName)) {\n          node.removeAttribute(attrName);\n        }\n        else if (attrName === 'href' || attrName === 'src') {\n          const attrValue = node.attributes.getNamedItem(attrName).value.toLowerCase();\n\n          // We're doing at runtime what the no-script-url rule does at compile\n          // time\n          // eslint-disable-next-line no-script-url\n          if (attrValue.indexOf('javascript:') === 0 || attrValue.indexOf('vbscript:') === 0) {\n            reparent(node);\n          }\n        }\n        else if (attrName === 'style') {\n          const styles = node\n            .attributes\n            .getNamedItem('style')\n            .value\n            .split(';')\n            .map((style) => {\n              const styleName = trim(style.split(':')[0]);\n\n              if (includes(allowedStyles, styleName)) {\n                return style;\n              }\n\n              return null;\n            })\n            .filter((style) => Boolean(style))\n            .join(';');\n\n          node.setAttribute('style', styles);\n        }\n      });\n    }\n    else {\n      escapeNode(node);\n    }\n  }\n}\n\n/**\n * Escapes a given html node\n * @param {Node} node\n * @returns {undefined}\n */\nfunction escapeNode(node) {\n  const before = document.createTextNode(`<${node.nodeName.toLowerCase()}>`);\n  const after = document.createTextNode(`</${node.nodeName.toLowerCase()}>`);\n\n  node.parentNode.insertBefore(before, node);\n  while (node.childNodes.length > 0) {\n    node.parentNode.insertBefore(node.childNodes[0], node);\n  }\n  node.parentNode.insertBefore(after, node);\n\n  removeNode(node);\n}\n\nconst trimPattern = /^\\s|\\s$/g;\n\n/**\n * @param {string} str\n * @returns {string}\n */\nfunction trim(str) {\n  return str.replace(trimPattern, '');\n}\n\n/**\n * @param {Node} node\n * @private\n * @returns {undefined}\n */\nfunction reparent(node) {\n  while (node.childNodes.length > 0) {\n    node.parentNode.insertBefore(node.childNodes[0], node);\n  }\n  removeNode(node);\n}\n\n/**\n * @param {NamedNodeMap} attributes\n * @private\n * @returns {Array<string>}\n */\nfunction listAttributeNames(attributes) {\n  return reduce(attributes, (attrNames, attr) => {\n    attrNames.push(attr.name);\n\n    return attrNames;\n  }, []);\n}\n\n/**\n * @param {Array} list\n * @param {Function} fn\n * @private\n * @returns {undefined}\n */\nfunction depthFirstForEach(list, fn) {\n  for (let i = list.length; i >= 0; i -= 1) {\n    fn(list[i]);\n  }\n}\n\n/**\n * @param {Node} o\n * @private\n * @returns {Boolean}\n */\nfunction isElement(o) {\n  if (!o) {\n    return false;\n  }\n\n  if (o.ownerDocument === undefined) {\n    return false;\n  }\n\n  if (o.nodeType !== 1) {\n    return false;\n  }\n\n  if (typeof o.nodeName !== 'string') {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Curried HTML filter.\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\nexport const filterSync = curry(_filterSync, 4);\n\n/**\n * Curried HTML filter that escapes rather than removes disallowed tags\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {Promise<string>}\n */\nexport const filterEscape = curry(_filterEscape, 4);\n\n/**\n * Curried HTML filter that escapes rather than removes disallowed tags\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\nexport const filterEscapeSync = curry(_filterEscapeSync, 4);\n"]}