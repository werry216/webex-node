{"version":3,"sources":["index.js"],"names":["namespaces","loggers","StorageAdapterLocalStorage","basekey","Bound","namespace","options","set","logger","rawData","localStorage","getItem","JSON","parse","allData","_getRawData","get","data","setItem","info","resolve","removeItem","key","_load","_save","reject","debug","value","NotFoundError","Error"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\nimport {NotFoundError} from '@webex/webex-core';\n\nconst namespaces = new WeakMap();\nconst loggers = new WeakMap();\n\n/**\n * localStorage adapter for webex-core storage layer\n */\nexport default class StorageAdapterLocalStorage {\n  /**\n   * @constructs {StorageAdapterLocalStorage}\n   * @param {string} basekey localStorage key underwhich all namespaces will be\n   * stored\n   */\n  constructor(basekey) {\n    /**\n     * localStorage binding\n     */\n    this.Bound = class {\n      /**\n       * @constructs {Bound}\n       * @param {string} namespace\n       * @param {Object} options\n       */\n      constructor(namespace, options) {\n        namespaces.set(this, namespace);\n        loggers.set(this, options.logger);\n      }\n\n      /**\n       * @private\n       * @returns {rawData}\n       */\n      _getRawData() {\n        const rawData = localStorage.getItem(basekey);\n\n        return rawData ? JSON.parse(rawData) : {};\n      }\n\n      /**\n       * @private\n       * @returns {mixed}\n       */\n      _load() {\n        const allData = this._getRawData();\n\n        return allData[namespaces.get(this)] || {};\n      }\n\n      /**\n       * @param {Object} data\n       * @private\n       * @returns {undefined}\n       */\n      _save(data) {\n        const allData = this._getRawData();\n\n        allData[namespaces.get(this)] = data;\n\n        localStorage.setItem(basekey, JSON.stringify(allData));\n      }\n\n      /**\n       * Clears the localStorage\n       * @param {string} key\n       * @returns {Promise}\n       */\n      clear() {\n        loggers.get(this).info('local-storage-store-adapter: clearing localStorage');\n\n        return Promise.resolve(localStorage.removeItem(basekey));\n      }\n\n      /**\n       * Removes the specified key\n       * @param {string} key\n       * @returns {Promise}\n       */\n      del(key) {\n        return new Promise((resolve) => {\n          loggers.get(this).info(`local-storage-store-adapter: deleting \\`${key}\\``);\n          const data = this._load();\n\n          Reflect.deleteProperty(data, key);\n          this._save(data);\n          resolve();\n        });\n      }\n\n      /**\n       * Retrieves the data at the specified key\n       * @param {string} key\n       * @returns {Promise<mixed>}\n       */\n      get(key) {\n        return new Promise((resolve, reject) => {\n          loggers.get(this).debug(`local-storage-store-adapter: reading \\`${key}\\``);\n          const data = this._load();\n          const value = data[key];\n\n          if (typeof value !== 'undefined') {\n            return resolve(value);\n          }\n\n          return reject(new NotFoundError(`No value found for ${key}`));\n        });\n      }\n\n      /**\n       * Stores the specified value at the specified key\n       * @param {string} key\n       * @param {mixed} value\n       * @returns {Promise}\n       */\n      put(key, value) {\n        return new Promise((resolve) => {\n          loggers.get(this).debug(`local-storage-store-adapter: writing \\`${key}\\``);\n          const data = this._load();\n\n          data[key] = value;\n          this._save(data);\n          resolve();\n        });\n      }\n    };\n  }\n\n  /**\n   * Returns an adapter bound to the specified namespace\n   * @param {string} namespace\n   * @param {Object} options\n   * @returns {Promise<Bound>}\n   */\n  bind(namespace, options) {\n    options = options || {};\n    if (!namespace) {\n      return Promise.reject(new Error('`namespace` is required'));\n    }\n\n    if (!options.logger) {\n      return Promise.reject(new Error('`options.logger` is required'));\n    }\n\n    options.logger.debug('local-storage-store-adapter: returning binding');\n\n    return Promise.resolve(new this.Bound(namespace, options));\n  }\n}\n"]}