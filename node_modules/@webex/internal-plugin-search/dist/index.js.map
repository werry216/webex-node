{"version":3,"sources":["index.js"],"names":["Search","config","payloadTransformer","predicates","name","direction","test","ctx","options","resolve","service","url","webex","internal","services","getServiceFromUrl","extract","body","response","then","res","activities","items","transforms","fn","object","encryption","encryptText","searchEncryptionKeyUrl","query","q"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {registerInternalPlugin} from '@webex/webex-core';\nimport {has} from 'lodash';\n\nimport Search from './search';\nimport config from './config';\n\nimport '@webex/internal-plugin-conversation';\nimport '@webex/internal-plugin-encryption';\n\nregisterInternalPlugin('search', Search, {\n  config,\n  payloadTransformer: {\n    predicates: [\n      {\n        name: 'encryptSearchQuery',\n        direction: 'outbound',\n        test(ctx, options) {\n          if (!has(options, 'body.query')) {\n            return Promise.resolve(false);\n          }\n\n          if (!has(options, 'body.searchEncryptionKeyUrl')) {\n            return Promise.resolve(false);\n          }\n\n          if (options.service === 'argonaut') {\n            return Promise.resolve(true);\n          }\n\n          if (options.url) {\n            const service = ctx.webex.internal.services.getServiceFromUrl(options.url);\n\n            return Promise.resolve(service && service.name === 'argonaut');\n          }\n\n          return Promise.resolve(false);\n        },\n        extract(options) {\n          return Promise.resolve(options.body);\n        }\n      },\n      {\n        name: 'transformObjectArray',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'body.activities.items[0].objectType'))\n            .then((res) => {\n              if (!res) {\n                return Promise.resolve(false);\n              }\n\n              if (response.options.service === 'argonaut') {\n                return Promise.resolve(true);\n              }\n\n              if (response.options.url) {\n                const service = ctx.webex.internal.services.getServiceFromUrl(response.options.url);\n\n                return Promise.resolve(service && service.name === 'argonaut');\n              }\n\n              return Promise.resolve(false);\n            });\n        },\n        extract(response) {\n          return Promise.resolve(response.body.activities.items);\n        }\n      }\n    ],\n    transforms: [\n      {\n        name: 'encryptSearchQuery',\n        direction: 'outbound',\n        fn(ctx, object) {\n          return ctx.webex.internal.encryption.encryptText(object.searchEncryptionKeyUrl, object.query)\n            .then((q) => {\n              object.query = q;\n            });\n        }\n      }\n    ]\n  }\n});\n\nexport {default} from './search';\n"]}