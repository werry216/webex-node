{"version":3,"sources":["kms-errors.js"],"names":["KmsError","body","enumerable","value","reason","requestId","status","message","constructor","defaultMessage","Exception","KmsTimeoutError","request","timeout","method","uri","DryError","WebexHttpError","prototype","parse","_res","options","url","service","toUpperCase","resource","headers","trackingid"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Exception} from '@webex/common';\nimport {WebexHttpError} from '@webex/webex-core';\n\n/**\n * Error class for KMS errors\n */\nexport class KmsError extends Exception {\n  static defaultMessage = 'An unknown error occurred while communicating with the kms. This implies we received an error response without a body.';\n\n  /**\n   * @param {HttpResponse} body\n   * @returns {string}\n   */\n  parse(body) {\n    body = body.body || body;\n\n    Object.defineProperties(this, {\n      body: {\n        enumerable: false,\n        value: body\n      },\n      reason: {\n        enumerable: false,\n        value: body.reason\n      },\n      requestId: {\n        enumerable: false,\n        value: body.requestId\n      },\n      status: {\n        enumerable: false,\n        value: body.status\n      }\n    });\n\n    let message = typeof body === 'string' ? body : body.reason;\n\n    if (!message) {\n      message = this.constructor.defaultMessage;\n    }\n    if (body.status) {\n      message += `\\nKMS_RESPONSE_STATUS: ${body.status}`;\n    }\n    if (body.requestId) {\n      message += `\\nKMS_REQUEST_ID: ${body.requestId}`;\n    }\n\n    return message;\n  }\n}\n\n/**\n * Thrown when an expected KMSResponse is not received in a timely manner\n */\nexport class KmsTimeoutError extends KmsError {\n  /**\n   * @param {KmsRequest} options.request\n   * @param {KmsRequest} options.timeout\n   * @returns {string}\n   */\n  parse({request = {}, timeout} = {}) {\n    let message = `The KMS did not respond within ${timeout ? `${timeout} milliseconds` : 'a timely fashion'}`;\n\n    if (request) {\n      if (request.method && request.uri) {\n        message += `\\nKMS_REQUEST: ${request.method} ${request.uri}`;\n      }\n\n      if (request.requestId) {\n        message += `\\nKMS_REQUEST_ID: ${request.requestId}`;\n      }\n    }\n\n    return message;\n  }\n}\n\n/**\n * Emitted when a REST request includes an encrypter error\n */\nexport class DryError extends WebexHttpError {\n  static defaultMessage = 'An unknown error was received from a service that proxies to the KMS';\n\n  /**\n   * @param {WebexHttpError} reason\n   * @returns {string}\n   */\n  parse(reason) {\n    Reflect.apply(WebexHttpError.prototype.parse, this, [reason._res]);\n    const body = reason._res.body.message;\n\n    let message = body.reason || body;\n\n    if (!message) {\n      message = this.constructor.defaultMessage;\n    }\n    if (this.options.url) {\n      message += `\\n${this.options.method} ${this.options.url}`;\n    }\n    else if (this.options.uri) {\n      message += `\\n${this.options.method} ${this.options.uri}`;\n    }\n    else {\n      message += `\\n${this.options.method} ${this.options.service.toUpperCase()}/${this.options.resource}`;\n    }\n    message += `\\nWEBEX_TRACKING_ID: ${this.options.headers.trackingid}`;\n\n    if (body.status) {\n      message += `\\nKMS_RESPONSE_STATUS: ${body.status}`;\n    }\n    if (body.requestId) {\n      message += `\\nKMS_REQUEST_ID: ${body.requestId}`;\n    }\n\n    Object.defineProperties(this, {\n      reason: {\n        enumerable: false,\n        value: body.reason\n      },\n      requestId: {\n        enumerable: false,\n        value: body.requestId\n      },\n      status: {\n        enumerable: false,\n        value: body.status\n      }\n    });\n\n    return message;\n  }\n}\n"]}