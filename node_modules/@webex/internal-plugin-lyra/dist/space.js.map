{"version":3,"sources":["space.js"],"names":["Space","WebexPlugin","extend","namespace","list","webex","request","method","api","resource","then","res","body","items","get","space","spaceId","id","identity","reject","Error","join","options","passType","pass","type","deviceUrl","internal","device","url","data","verificationInitiation","uri","leave","removeAllDevices","params","base64","toBase64Url","querystring","stringify","verifyOccupant","occupantId","getCurrentBindings","bindConversation","conversation","kmsResourceObjectUrl","kmsMessage","resourceUri","userIds","conversationUrl","_bindConversation","resolve","encodedDeviceUrl","encode","bindingCleanupAfterCall","unbindConversation","parameters","authId","encryption","kms","prepareRequest","req","wrapped","deleteBinding","bindingId"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport querystring from 'querystring';\n\nimport {WebexPlugin} from '@webex/webex-core';\nimport {base64} from '@webex/common';\n\n/**\n * @class\n * @extends {Lyra}\n * @memberof Lyra\n */\nconst Space = WebexPlugin.extend({\n  namespace: 'Lyra',\n\n  /**\n   * Lists lyra spaces associated with user\n   *\n   * @returns {Promise<Array>} spaces\n   */\n  list() {\n    return this.webex.request({\n      method: 'GET',\n      api: 'lyra',\n      resource: '/spaces'\n    })\n      .then((res) => res.body.items);\n  },\n\n  /**\n   * Retrieves a lyra space info\n   * @param {Types~LyraSpace} space\n   * @param {string} space.id\n   * @param {string} space.identity.id\n   * @returns {Promise<LyraSpace>} response body\n   */\n  get(space = {}) {\n    const spaceId = space.id || space.identity && space.identity.id;\n\n    if (!spaceId) {\n      return Promise.reject(new Error('space.id is required'));\n    }\n\n    return this.webex.request({\n      method: 'GET',\n      api: 'lyra',\n      resource: `/spaces/${spaceId}`\n    })\n      .then((res) => res.body);\n  },\n\n  /**\n   * Joins a lyra space, update every 10 minutes to keep alive for MANUAL\n   * @param {Types~LyraSpace} space\n   * @param {string} space.url\n   * @param {object} options\n   * @param {string} options.passType\n   * @param {string} options.data additional data such as proof for ultrasound\n   * @param {string} options.uri use a custom uri\n   * @returns {Promise}\n   */\n  join(space, options) {\n    options = Object.assign({\n      passType: 'MANUAL'\n    }, options);\n\n    const body = {\n      pass: {\n        type: options.passType\n      },\n      deviceUrl: this.webex.internal.device.url\n    };\n\n    if (options.data) {\n      body.pass.data = options.data;\n    }\n\n    if (options.verificationInitiation) {\n      body.verificationInitiation = options.verificationInitiation;\n    }\n\n    // if options.uri is available use it, since that would have the\n    // complete lyra service URL\n    if (options.uri) {\n      return this.webex.request({\n        method: 'PUT',\n        uri: options.uri,\n        body\n      });\n    }\n\n    return this.webex.request({\n      method: 'PUT',\n      api: 'lyra',\n      resource: `${space.url}/occupants/@me`,\n      body\n    });\n  },\n\n  /**\n   * Leaves a lyra space\n   * @param {Types~LyraSpace} space\n   * @param {string} space.url\n   * @param {object} options\n   * @param {boolean} options.removeAllDevices remove all devices of current user also\n   * @returns {Promise}\n   */\n  leave(space, options = {}) {\n    // all devices are removed by default (when deviceUrl is not supplied)\n    let uri = `${space.url}/occupants/@me`;\n\n    if (!options.removeAllDevices) {\n      const params = {\n        deviceUrl: base64.toBase64Url(this.webex.internal.device.url)\n      };\n\n      uri += `?${querystring.stringify(params)}`;\n    }\n\n    return this.webex.request({\n      method: 'DELETE',\n      api: 'lyra',\n      resource: uri\n    });\n  },\n\n  /**\n   * Verifies a space occupant (to be used by the lyra device)\n   * @param {Types~LyraSpace} space\n   * @param {string} space.url\n   * @param {string} occupantId id of user to verify\n   * @returns {Promise}\n   */\n  verifyOccupant(space, occupantId) {\n    const body = {\n      pass: {\n        type: 'VERIFICATION'\n      }\n    };\n\n    return this.webex.request({\n      method: 'PUT',\n      uri: `${space.url}/occupants/${occupantId}`,\n      body\n    });\n  },\n\n\n  /**\n   * Gets the state of bindings in this Lyra space\n   * @param {Types~LyraSpace} space\n   * @param {string} space.url\n   * @returns {Promise<LyraBindings>} bindings response body\n   */\n  getCurrentBindings(space) {\n    return this.webex.request({\n      method: 'GET',\n      uri: `${space.url}/bindings`\n    })\n      .then((res) => res.body);\n  },\n\n  /**\n   * Binds a conversation to lyra space\n   * @param {Types~LyraSpace} space\n   * @param {string} space.url\n   * @param {string} space.id\n   * @param {string} space.identity.id\n   * @param {Types~Conversation} conversation\n   * @param {string} conversation.kmsResourceObjectUrl\n   * @param {string} conversation.url\n   * @param {object} options\n   * @param {boolean} options.uri complete lyra service URL\n   * @returns {Promise<LyraBindings>} bindings response body\n   */\n  bindConversation(space = {}, conversation = {}, options = {}) {\n    const spaceId = space.id || space.identity && space.identity.id;\n\n    if (!space.url) {\n      return Promise.reject(new Error('space.url is required'));\n    }\n\n    if (!spaceId) {\n      return Promise.reject(new Error('space.id is required'));\n    }\n\n    if (!conversation.kmsResourceObjectUrl) {\n      return Promise.reject(new Error('conversation.kmsResourceObjectUrl is required'));\n    }\n\n    if (!conversation.url) {\n      return Promise.reject(new Error('conversation.url is required'));\n    }\n\n    const body = {\n      kmsMessage: {\n        method: 'create',\n        uri: '/authorizations',\n        resourceUri: `${conversation.kmsResourceObjectUrl}`,\n        userIds: [spaceId]\n      },\n      conversationUrl: conversation.url\n    };\n\n    const request = {\n      method: 'POST',\n      body\n    };\n\n    // if options.uri is available use it, since that would have the\n    // complete lyra service URL\n    if (options.uri) {\n      request.uri = options.uri;\n    }\n    else {\n      request.api = 'lyra';\n      request.resource = `${space.url}/bindings`;\n    }\n\n    return this._bindConversation(spaceId)\n      .then(() => this.webex.request(request))\n      .then((res) => res.body);\n  },\n\n  /**\n   * Binds a conversation to lyra space by posting capabilities to Lyra.\n   *\n   * Lyra no longer automatically enables binding for a space containing a device with type \"SPARK_BOARD\".\n   * Webexboard now is running the CE code stack which supports posting of capabilities to Lyra.\n   * @param {String} spaceId space ID\n   * @returns {Promise<LyraBindings>} bindings response body\n   */\n  _bindConversation(spaceId) {\n    // Skip until we can bind a conversation to lyra space by posting capabilities to Lyra.\n    /* eslint no-unreachable: 1 */\n    return Promise.resolve();\n\n    // PUT /lyra/api/v1/spaces/{spaceId}/devices/{encodedDeviceUrl}/capabilities\n    const encodedDeviceUrl = base64.encode(this.webex.internal.device.url);\n    const resource = `spaces/${spaceId}/devices/${encodedDeviceUrl}/capabilities`;\n\n    return this.webex.request({\n      method: 'PUT',\n      api: 'lyra',\n      resource,\n      body: {\n        bindingCleanupAfterCall: true\n      }\n    });\n  },\n\n  /**\n   * Removes binding between a conversation and a lyra space using conversation\n   * url\n   * @param {Types~LyraSpace} space\n   * @param {string} space.url\n   * @param {string} space.id\n   * @param {string} space.identity.id\n   * @param {Types~Conversation} conversation\n   * @param {string} conversation.kmsResourceObjectUrl\n   * @param {string} conversation.url\n   * @param {object} options\n   * @param {boolean} options.uri complete lyra service URL\n   * @returns {Promise<LyraBindings>} bindings response body\n   */\n  unbindConversation(space = {}, conversation = {}, options = {}) {\n    const spaceId = space.id || space.identity && space.identity.id;\n\n    if (!space.url) {\n      return Promise.reject(new Error('space.url is required'));\n    }\n\n    if (!spaceId) {\n      return Promise.reject(new Error('space.id is required'));\n    }\n\n    if (!conversation.url) {\n      return Promise.reject(new Error('conversation.url is required'));\n    }\n\n    if (!conversation.kmsResourceObjectUrl) {\n      return Promise.reject(new Error('conversation.kmsResourceObjectUrl is required'));\n    }\n\n    const parameters = {\n      kmsMessage: {\n        method: 'delete',\n        uri: `${conversation.kmsResourceObjectUrl}/authorizations?${querystring.stringify({authId: spaceId})}`\n      },\n      conversationUrl: base64.toBase64Url(conversation.url)\n    };\n\n    return this.webex.internal.encryption.kms.prepareRequest(parameters.kmsMessage)\n      .then((req) => {\n        parameters.kmsMessage = req.wrapped;\n        // if options.uri is available use it, since that would have the\n        // complete lyra service URL\n        if (options.uri) {\n          return this.webex.request({\n            method: 'DELETE',\n            uri: `${options.uri}?${querystring.stringify(parameters)}`\n          });\n        }\n\n        return this.webex.request({\n          method: 'DELETE',\n          api: 'lyra',\n          resource: `${space.url}/bindings?${querystring.stringify(parameters)}`\n        });\n      });\n  },\n\n  /**\n   * Delete a binding using binding id\n   * @param {Types~LyraSpace} space\n   * @param {string} space.url\n   * @param {string} space.identity.id\n   * @param {object} options\n   * @param {string} options.kmsResourceObjectUrl\n   * @param {string} options.bindingId\n   * @returns {Promise<LyraBindings>} bindings response body\n   */\n  deleteBinding(space = {}, options = {}) {\n    const spaceId = space.id || space.identity && space.identity.id;\n\n    if (!space.url) {\n      return Promise.reject(new Error('space.url is required'));\n    }\n\n    if (!spaceId) {\n      return Promise.reject(new Error('space.id is required'));\n    }\n\n    if (!options.kmsResourceObjectUrl) {\n      return Promise.reject(new Error('options.kmsResourceObjectUrl is required'));\n    }\n\n    if (!options.bindingId) {\n      return Promise.reject(new Error('options.bindingId is required'));\n    }\n\n    const parameters = {\n      kmsMessage: {\n        method: 'delete',\n        uri: `${options.kmsResourceObjectUrl}/authorizations?${querystring.stringify({authId: spaceId})}`\n      }\n    };\n\n    return this.webex.internal.encryption.kms.prepareRequest(parameters.kmsMessage)\n      .then((req) => {\n        parameters.kmsMessage = req.wrapped;\n\n        return this.webex.request({\n          method: 'DELETE',\n          uri: `${space.url}/bindings/${options.bindingId}?${querystring.stringify(parameters)}`\n        });\n      });\n  }\n});\n\nexport default Space;\n"]}